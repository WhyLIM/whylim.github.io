{
    "version": "https://jsonfeed.org/version/1",
    "title": "Being on sea, sail; being on land, settle. • All posts by \"wgs\" category",
    "description": "",
    "home_page_url": "https://new.limina.top",
    "items": [
        {
            "id": "https://new.limina.top/2024/06/26/Annovar%E6%B3%A8%E9%87%8AVCF%E6%96%87%E4%BB%B6/",
            "url": "https://new.limina.top/2024/06/26/Annovar%E6%B3%A8%E9%87%8AVCF%E6%96%87%E4%BB%B6/",
            "title": "使用 Annovar 注释 VCF 文件",
            "date_published": "2024-06-26T09:26:55.000Z",
            "content_html": "<h1 id=\"使用-annovar-注释-vcf-文件\"><a class=\"anchor\" href=\"#使用-annovar-注释-vcf-文件\">#</a> 使用 Annovar 注释 VCF 文件</h1>\n<blockquote>\n<p>变异注释是基因组学研究中的关键步骤，帮助研究人员理解变异的功能意义。Annovar (ANNOtate VARiation) 是一个广泛使用的工具，用于对变异进行功能注释。</p>\n</blockquote>\n<p><img loading=\"lazy\" data-src=\"https://img.limina.top/blog/image-20240627110341101.png\" alt=\"image-20240627110341101\" /></p>\n<h2 id=\"安装-annovar\"><a class=\"anchor\" href=\"#安装-annovar\">#</a> 安装 Annovar</h2>\n<p>下载 Annovar 需要在 <a href=\"https://www.openbioinformatics.org/annovar/annovar_download_form.php\">此处</a> 用教育邮箱注册，然后邮箱中会收到下载链接。</p>\n<details class=\"info\"><summary>如果你没有教育邮箱</summary><div>\n<p><a href=\"http://www.openbioinformatics.org/annovar/download/0wgxR2rIVP/annovar.latest.tar.gz\">这里</a> 或许是一个可以下载的链接</p>\n</div></details>\n<p>解压压缩包</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> annovar.latest.tar.gz</pre></td></tr></table></figure><p>根据自己的习惯看要不要配置环境变量，此处以不配置环境变量为例</p>\n<p>Annovar 的可执行文件存放在  <code>~/annovar/</code>  下，因此后续使用都要带上这个前缀，为绝对路径调用</p>\n<h2 id=\"准备数据\"><a class=\"anchor\" href=\"#准备数据\">#</a> 准备数据</h2>\n<p>我的目录结构如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>└── ── 16794B/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    └── ── clean_data/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    └── ── gvcf/</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    └── ── result_alignment/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    └── ── result_variation/</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        └── ── cnv/</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        └── ── indel/</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        └── ── snp/</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        └── ── sv/</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>└── ── 16794N/</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    └── ── clean_data/</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    └── ── gvcf/</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    └── ── result_alignment/</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    └── ── result_variation/</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        └── ── cnv/</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        └── ── indel/</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        └── ── snp/</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        └── ── sv/</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>其中需要注释的 VCF 文件存在于每个样本的  <code>gvcf/</code>  目录下，是一个  <code>.g.vcf.gz</code>  文件</p>\n<h2 id=\"简单的示例\"><a class=\"anchor\" href=\"#简单的示例\">#</a> 简单的示例</h2>\n<h3 id=\"步骤-1转换-vcf-文件\"><a class=\"anchor\" href=\"#步骤-1转换-vcf-文件\">#</a> 步骤 1：转换 VCF 文件</h3>\n<p>Annovar 使用其专有的输入格式，因此首先需要将 VCF 文件转换为 Annovar 的输入格式。例如对  <code>16794N.g.vcf.gz</code>  文件进行转换：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>perl ~/annovar/convert2annovar.pl <span class=\"token parameter variable\">-format</span> vcf4 16794N/gvcf/16794N.g.vcf.gz <span class=\"token operator\">></span> 16794N.avinput</pre></td></tr></table></figure><p>这将生成一个  <code>sample.avinput</code>  文件，作为后续注释的输入。</p>\n<h3 id=\"步骤-2下载-annovar-数据库\"><a class=\"anchor\" href=\"#步骤-2下载-annovar-数据库\">#</a> 步骤 2：下载 Annovar 数据库</h3>\n<p>在进行注释之前，需要下载相关的数据库。所有支持的数据库可以在 <a href=\"https://annovar.openbioinformatics.org/en/latest/user-guide/download/\">官网</a> 上找到：</p>\n<p>例如，我使用 RefGene, cytoBand, 1000g2015aug, dbnsfp42c, cg69, ljb26_all, snp138 数据库进行注释：</p>\n<p>RefGene 数据库已经在  <code>humandb/</code>  目录下，不需要下载</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>perl ~/annovar/annotate_variation.pl <span class=\"token parameter variable\">--downdb</span> <span class=\"token parameter variable\">--buildver</span> hg19 cytoBand humandb/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>perl ~/annovar/annotate_variation.pl <span class=\"token parameter variable\">--downdb</span> <span class=\"token parameter variable\">--webfrom</span> annovar <span class=\"token parameter variable\">--buildver</span> hg19 1000g2015aug humandb/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>perl ~/annovar/annotate_variation.pl <span class=\"token parameter variable\">--downdb</span> <span class=\"token parameter variable\">--webfrom</span> annovar <span class=\"token parameter variable\">--buildver</span> hg19 dbnsfp42c humandb/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>perl ~/annovar/annotate_variation.pl <span class=\"token parameter variable\">--downdb</span> <span class=\"token parameter variable\">--webfrom</span> annovar <span class=\"token parameter variable\">--buildver</span> hg19 cg69 humandb/</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>perl ~/annovar/annotate_variation.pl <span class=\"token parameter variable\">--downdb</span> <span class=\"token parameter variable\">--webfrom</span> annovar <span class=\"token parameter variable\">--buildver</span> hg19 ljb26_all humandb/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>perl ~/annovar/annotate_variation.pl <span class=\"token parameter variable\">--downdb</span> <span class=\"token parameter variable\">--webfrom</span> annovar <span class=\"token parameter variable\">--buildver</span> hg19 snp138 humandb/</pre></td></tr></table></figure><h3 id=\"步骤-3变异注释\"><a class=\"anchor\" href=\"#步骤-3变异注释\">#</a> 步骤 3：变异注释</h3>\n<p>下载完数据库后，可以开始注释 VCF 文件中的变异。例如对样本  <code>16794N</code>  进行注释：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>perl ~/annovar/table_annovar.pl 16794N.avinput ~/annovar/humandb/ <span class=\"token parameter variable\">-buildver</span> hg19 <span class=\"token parameter variable\">-out</span> 16794N <span class=\"token parameter variable\">-remove</span> <span class=\"token parameter variable\">-protocol</span> refGene,cytoBand,1000g2015aug_all,1000g2015aug_eur,1000g2015aug_afr,dbnsfp42c,cg69,ljb26_all,snp138 <span class=\"token parameter variable\">-operation</span> g,r,f,f,f,f,f,f,f <span class=\"token parameter variable\">-nastring</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-csvout</span></pre></td></tr></table></figure><p>在这个命令中：</p>\n<ul>\n<li><code>-buildver hg19</code>  指定参考基因组版本。</li>\n<li><code>-out sample</code>  指定输出文件的前缀。</li>\n<li><code>-remove</code>  表示注释完成后删除中间文件。</li>\n<li><code>-protocol</code>  指定使用的数据库，这里使用了  <code>refGene</code> 、 <code>cytoBand</code> 、 <code>1000g2015aug_all</code> 、 <code>1000g2015aug_eur</code> 、 <code>1000g2015aug_afr</code> 、 <code>dbnsfp42c</code> 、 <code>cg69</code> 、 <code>ljb26_all</code> 、 <code>snp138</code> 。</li>\n<li><code>-operation</code>  指定每个数据库的操作类型， <code>g</code>  表示基因注释， <code>r</code>  表示区域注释， <code>f</code>  表示过滤数据库。</li>\n<li><code>-nastring .</code>  指定将缺失值表示为 &quot;.&quot;</li>\n<li><code>-csvout</code>  表示输出文件为 CSV 格式。</li>\n</ul>\n<h3 id=\"步骤-4查看结果\"><a class=\"anchor\" href=\"#步骤-4查看结果\">#</a> 步骤 4：查看结果</h3>\n<p>由于我们删除了中间文件，注释完成后我们将只得到 1 个 csv 输出文件  <code>16794B.hg19_multianno.csv</code></p>\n<h2 id=\"批量操作\"><a class=\"anchor\" href=\"#批量操作\">#</a> 批量操作</h2>\n<p>现在我们对 22 个样本进行批量注释：</p>\n<h3 id=\"使用循环\"><a class=\"anchor\" href=\"#使用循环\">#</a> 使用循环</h3>\n<p>如果服务器比较拥挤，可以使用循环：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nano</span> process_vcfs.sh</pre></td></tr></table></figure><p>写入以下代码：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 定义样本文件夹的根目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">root_dir</span><span class=\"token operator\">=~</span>/WGS_SD/result</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 循环处理每个样本文件夹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">sample_dir</span> <span class=\"token keyword\">in</span> <span class=\"token string\">\"<span class=\"token variable\">$root_dir</span>\"</span>/*<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token assign-left variable\">sample_name</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token assign-left variable\">vcf_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.g.vcf.gz\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token assign-left variable\">avinput_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.avinput\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token assign-left variable\">output_prefix</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.annovar\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\"># 检查 VCF 文件是否存在</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$vcf_file</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Processing <span class=\"token variable\">$vcf_file</span>\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\"># 检查 AVINPUT 文件是否存在</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$avinput_file</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\"># 将 VCF 文件转换为 ANNOVAR 输入格式</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Converting <span class=\"token variable\">$vcf_file</span> to <span class=\"token variable\">$avinput_file</span>\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        perl ~/annovar/convert2annovar.pl <span class=\"token parameter variable\">-format</span> vcf4 <span class=\"token string\">\"<span class=\"token variable\">$vcf_file</span>\"</span> <span class=\"token parameter variable\">-outfile</span> <span class=\"token string\">\"<span class=\"token variable\">$avinput_file</span>\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$avinput_file</span> already exists, skipping conversion.\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token comment\"># 进行注释</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      perl ~/annovar/table_annovar.pl <span class=\"token string\">\"<span class=\"token variable\">$avinput_file</span>\"</span> ~/annovar/humandb/ <span class=\"token parameter variable\">-buildver</span> hg19 <span class=\"token parameter variable\">-out</span> <span class=\"token string\">\"<span class=\"token variable\">$output_prefix</span>\"</span> <span class=\"token parameter variable\">-remove</span> <span class=\"token parameter variable\">-protocol</span> refGene,cytoBand,1000g2015aug_all,1000g2015aug_eur,1000g2015aug_afr,dbnsfp42c,cg69,ljb26_all,snp138 <span class=\"token parameter variable\">-operation</span> g,r,f,f,f,f,f,f,f <span class=\"token parameter variable\">-nastring</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-csvout</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"VCF file <span class=\"token variable\">$vcf_file</span> not found, skipping.\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>赋予执行权限，并使用 nohup 命令后台运行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> +x process_vcfs.sh</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">nohup</span> ./process_vcfs.sh <span class=\"token operator\">></span> process_vcfs.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></pre></td></tr></table></figure><h3 id=\"同时进行\"><a class=\"anchor\" href=\"#同时进行\">#</a> 同时进行</h3>\n<p>当我们的 vcf 文件很大的时候，转换和注释通常非常耗时，因此在服务器空闲的情况下我们可以同时进行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nano</span> run_all_samples.sh</pre></td></tr></table></figure><p>写入以下代码：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 定义样本文件夹的根目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">root_dir</span><span class=\"token operator\">=~</span>/WGS_SD/result</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 循环处理每个样本文件夹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">sample_dir</span> <span class=\"token keyword\">in</span> <span class=\"token string\">\"<span class=\"token variable\">$root_dir</span>\"</span>/*<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token assign-left variable\">sample_name</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token assign-left variable\">vcf_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.g.vcf.gz\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token assign-left variable\">avinput_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.avinput\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token assign-left variable\">output_prefix</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.annovar\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token assign-left variable\">output_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\">$&#123;sample_name&#125;</span>.annovar.hg19_multianno.csv\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token assign-left variable\">script_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$&#123;sample_name&#125;</span>_process.sh\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\"># 检查是否已经完成注释</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$output_file</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Annotation for <span class=\"token variable\">$sample_name</span> already completed, skipping.\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token builtin class-name\">continue</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\"># 检查 VCF 文件是否存在</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$vcf_file</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Processing <span class=\"token variable\">$vcf_file</span>\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token comment\"># 生成处理脚本</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOT<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> <span class=\"token variable\">$script_file</span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>#!/bin/bash</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre># 定义变量</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>vcf_file=\"<span class=\"token variable\">$vcf_file</span>\"</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>avinput_file=\"<span class=\"token variable\">$avinput_file</span>\"</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>output_prefix=\"<span class=\"token variable\">$output_prefix</span>\"</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre># 检查 AVINPUT 文件是否存在</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>if [ ! -f \"\\<span class=\"token variable\">$avinput_file</span>\" ]; then</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  # 将 VCF 文件转换为 ANNOVAR 输入格式</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  echo \"Converting \\<span class=\"token variable\">$vcf_file</span> to \\<span class=\"token variable\">$avinput_file</span>\"</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  perl ~/annovar/convert2annovar.pl -format vcf4 \"\\<span class=\"token variable\">$vcf_file</span>\" -outfile \"\\<span class=\"token variable\">$avinput_file</span>\"</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>else</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  echo \"\\<span class=\"token variable\">$avinput_file</span> already exists, skipping conversion.\"</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>fi</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre># 进行注释</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>perl ~/annovar/table_annovar.pl \"\\<span class=\"token variable\">$avinput_file</span>\" ~/annovar/humandb/ -buildver hg19 -out \"\\<span class=\"token variable\">$output_prefix</span>\" -remove -protocol refGene,cytoBand,1000g2015aug_all,1000g2015aug_eur,1000g2015aug_afr,dbnsfp42c,cg69,ljb26_all,snp138 -operation g,r,f,f,f,f,f,f,f -nastring . -csvout</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>EOT</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token comment\"># 确保脚本具有可执行权限</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token function\">chmod</span> +x <span class=\"token variable\">$script_file</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token comment\"># 使用 nohup 运行处理脚本</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token function\">nohup</span> ./<span class=\"token variable\">$script_file</span> <span class=\"token operator\">></span> <span class=\"token variable\">$&#123;sample_name&#125;</span>_process.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"VCF file <span class=\"token variable\">$vcf_file</span> not found, skipping.\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>赋予执行权限，并使用 nohup 命令后台运行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> +x run_all_samples.sh</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">nohup</span> ./run_all_samples.sh <span class=\"token operator\">></span> run_all_samples.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></pre></td></tr></table></figure><h2 id=\"结果处理\"><a class=\"anchor\" href=\"#结果处理\">#</a> 结果处理</h2>\n<p>查看注释结果</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>limin@localhost result<span class=\"token punctuation\">]</span>$ <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">3</span> 16794B/gvcf/16794B.annovar.hg19_multianno.csv </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Chr,Start,End,Ref,Alt,Func.refGene,Gene.refGene,GeneDetail.refGene,ExonicFunc.refGene,AAChange.refGene,cytoBand,1000g2015aug_all,1000g2015aug_eur,1000g2015aug_afr,SIFT_score,SIFT_converted_rankscore,SIFT_pred,SIFT4G_score,SIFT4G_converted_rankscore,SIFT4G_pred,LRT_score,LRT_converted_rankscore,LRT_pred,MutationTaster_score,MutationTaster_converted_rankscore,MutationTaster_pred,MutationAssessor_score,MutationAssessor_rankscore,MutationAssessor_pred,FATHMM_score,FATHMM_converted_rankscore,FATHMM_pred,PROVEAN_score,PROVEAN_converted_rankscore,PROVEAN_pred,MetaSVM_score,MetaSVM_rankscore,MetaSVM_pred,MetaLR_score,MetaLR_rankscore,MetaLR_pred,MetaRNN_score,MetaRNN_rankscore,MetaRNN_pred,M-CAP_score,M-CAP_rankscore,M-CAP_pred,MutPred_score,MutPred_rankscore,MVP_score,MVP_rankscore,MPC_score,MPC_rankscore,PrimateAI_score,PrimateAI_rankscore,PrimateAI_pred,DEOGEN2_score,DEOGEN2_rankscore,DEOGEN2_pred,BayesDel_addAF_score,BayesDel_addAF_rankscore,BayesDel_addAF_pred,BayesDel_noAF_score,BayesDel_noAF_rankscore,BayesDel_noAF_pred,ClinPred_score,ClinPred_rankscore,ClinPred_pred,LIST-S2_score,LIST-S2_rankscore,LIST-S2_pred,Aloft_pred,Aloft_Confidence,DANN_score,DANN_rankscore,fathmm-MKL_coding_score,fathmm-MKL_coding_rankscore,fathmm-MKL_coding_pred,fathmm-XF_coding_score,fathmm-XF_coding_rankscore,fathmm-XF_coding_pred,Eigen-raw_coding,Eigen-raw_coding_rankscore,Eigen-PC-raw_coding,Eigen-PC-raw_coding_rankscore,integrated_fitCons_score,integrated_fitCons_rankscore,integrated_confidence_value,GERP++_NR,GERP++_RS,GERP++_RS_rankscore,phyloP100way_vertebrate,phyloP100way_vertebrate_rankscore,phyloP30way_mammalian,phyloP30way_mammalian_rankscore,phastCons100way_vertebrate,phastCons100way_vertebrate_rankscore,phastCons30way_mammalian,phastCons30way_mammalian_rankscore,SiPhy_29way_logOdds,SiPhy_29way_logOdds_rankscore,Interpro_domain,GTEx_V8_gene,GTEx_V8_tissue,cg69,SIFT_score,SIFT_pred,Polyphen2_HDIV_score,Polyphen2_HDIV_pred,Polyphen2_HVAR_score,Polyphen2_HVAR_pred,LRT_score,LRT_pred,MutationTaster_score,MutationTaster_pred,MutationAssessor_score,MutationAssessor_pred,FATHMM_score,FATHMM_pred,RadialSVM_score,RadialSVM_pred,LR_score,LR_pred,VEST3_score,CADD_raw,CADD_phred,GERP++_RS,phyloP46way_placental,phyloP100way_vertebrate,SiPhy_29way_logOdds,snp138</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>chrM,150,150,T,C,<span class=\"token string\">\"upstream\"</span>,<span class=\"token string\">\"RNR1\"</span>,<span class=\"token string\">\"dist=500\"</span>,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,<span class=\"token string\">\"rs62581312\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>chrM,195,195,C,T,<span class=\"token string\">\"upstream\"</span>,<span class=\"token string\">\"RNR1\"</span>,<span class=\"token string\">\"dist=455\"</span>,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,<span class=\"token string\">\"rs2857291\"</span></pre></td></tr></table></figure><p>发现有些值两侧有引号，这会对后面的处理产生影响，需要去除引号</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nano</span> remove_quotes.sh</pre></td></tr></table></figure><p>写入以下代码：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 定义样本文件夹的根目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">root_dir</span><span class=\"token operator\">=</span><span class=\"token string\">\"/home/limin/WGS_SD/result\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 遍历每个样本文件夹</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">sample_dir</span> <span class=\"token keyword\">in</span> <span class=\"token string\">\"<span class=\"token variable\">$root_dir</span>\"</span>/*<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token comment\"># 检查是否为目录</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\"># 定义原始 CSV 文件路径</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token assign-left variable\">csv_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span><span class=\"token variable\">)</span></span>.annovar.hg19_multianno.csv\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\"># 定义去除引号后的新文件路径</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token assign-left variable\">new_csv_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span><span class=\"token variable\">)</span></span>.annovar.hg19_multianno_no_quotes.csv\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\"># 检查原始 CSV 文件是否存在</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$csv_file</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\"># 去除 CSV 文件中的引号，并保存到新文件</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token function\">tail</span> <span class=\"token parameter variable\">-n</span> +1 <span class=\"token string\">\"<span class=\"token variable\">$csv_file</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/\"//g'</span> <span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">$new_csv_file</span>\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Processed <span class=\"token variable\">$csv_file</span> -> <span class=\"token variable\">$new_csv_file</span>\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"File <span class=\"token variable\">$csv_file</span> does not exist.\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>赋予执行权限，并使用 nohup 命令后台运行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> +x remove_quotes.sh</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">nohup</span> ./remove_quotes.sh <span class=\"token operator\">></span> remove_quotes.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></pre></td></tr></table></figure><h2 id=\"筛选并合并所有样本的注释\"><a class=\"anchor\" href=\"#筛选并合并所有样本的注释\">#</a> 筛选并合并所有样本的注释</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nano</span> merge_annotations.sh</pre></td></tr></table></figure><p>写入以下代码：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 定义样本文件夹的根目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">root_dir</span><span class=\"token operator\">=~</span>/WGS_SD/result</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">output_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"merged_annotations.csv\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 创建合并文件并添加表头</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Chr,Start,End,Ref,Alt,Gene.refGene,GeneDetail.refGene,ExonicFunc.refGene,AAChange.refGene,Func.refGene,cytoBand,1000g2015aug_all,Tumor_Sample_Barcode\"</span> <span class=\"token operator\">></span> <span class=\"token variable\">$output_file</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 遍历所有样本文件夹</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">sample_dir</span> <span class=\"token keyword\">in</span> <span class=\"token string\">\"<span class=\"token variable\">$root_dir</span>\"</span>/*<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\"># 查找注释 CSV 文件</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token assign-left variable\">sample_file</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>/gvcf/<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_dir</span>\"</span><span class=\"token variable\">)</span></span>.annovar.hg19_multianno_no_quotes.csv\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_file</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token assign-left variable\">sample_name</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_file</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d. <span class=\"token parameter variable\">-f1</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\"># 使用 awk 处理文件</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token function\">awk</span> <span class=\"token parameter variable\">-v</span> <span class=\"token assign-left variable\">sample</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$sample_name</span>\"</span> -F<span class=\"token string\">','</span> <span class=\"token string\">'</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      BEGIN &#123; OFS=\",\" &#125;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      NR == 1 &#123; next &#125; # 跳过表头</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      $6 != \"intergenic\" &amp;&amp; $6 != \"intronic\" &amp;&amp; $12 &lt; 0.001 &amp;&amp; $12 != \".\" &#123;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        print $1, $2, $3, $4, $5, $7, $8, $9, $10, $6, $11, $12, sample</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      &#125;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      '</span> <span class=\"token string\">\"<span class=\"token variable\">$sample_file</span>\"</span> <span class=\"token operator\">>></span> <span class=\"token variable\">$output_file</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr></table></figure><p>赋予执行权限，并使用 nohup 命令后台运行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> +x merge_annotations.sh</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">nohup</span> ./merge_annotations.sh <span class=\"token operator\">></span> merge_annotations.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></pre></td></tr></table></figure><h2 id=\"annovar-注释结果与-maf-文件的转换\"><a class=\"anchor\" href=\"#annovar-注释结果与-maf-文件的转换\">#</a> Annovar 注释结果与 MAF 文件的转换</h2>\n<p>MAF 文件是 Mutation Annotation Format 文件的缩写，是一种用于存储基因突变注释信息的标准文件格式。</p>\n<h3 id=\"如果你的-annovar-注释结果比较多\"><a class=\"anchor\" href=\"#如果你的-annovar-注释结果比较多\">#</a> 如果你的 Annovar 注释结果比较多</h3>\n<p>可以使用 <a href=\"https://github.com/PoisonAlien/annovar2maf\">annovar2maf</a></p>\n<p>这是一个 python 编写的脚本，不过他是针对 txt 文件的，由于我们的注释结果保存为了 csv 文件，需要将脚本中的  <code>line.split(&quot;\\t&quot;)</code>  替换为  <code>line.split(&quot;,&quot;)</code></p>\n<p>以下是替换后的脚本</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#!/usr/bin/env python</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># File: annovar2maf.py</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Author: Anand Mayakonda [https://github.com/PoisonAlien]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Created: July 19, 2023</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Description: This script converts annovar annotations and bcftools csq output to MAF</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># MIT License</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Copyright (c) [2023] [Anand Mayakonda]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> argparse</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> os<span class=\"token punctuation\">.</span>path</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> re</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">get_variant_type</span><span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">,</span> alt<span class=\"token punctuation\">,</span> vc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    Estimate Variany Type based on ref and alt alleles</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    variant_type_mappings <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token string\">\"Frameshift_INDEL\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"INS\"</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>alt<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token string\">\"DEL\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token string\">\"Inframe_INDEL\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"INS\"</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>alt<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token string\">\"DEL\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token string\">\"Missense_Mutation\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"SNP\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    ref_alt <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>ref<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">></span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>alt<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    ref_alt_len <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>alt<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    ref_alt_diff <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>alt<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span> vc <span class=\"token keyword\">in</span> variant_type_mappings<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> variant_type_mappings<span class=\"token punctuation\">[</span>vc<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt_diff <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"INS\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt_diff <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"DEL\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"->A\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"->C\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"->T\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"->G\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"INS\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"A>-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"C>-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"T>-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"G>-\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"DEL\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt_len <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"SNP\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt_len <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"DNP\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt_len <span class=\"token operator\">==</span> <span class=\"token number\">6</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"TNP\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">elif</span> ref_alt_len <span class=\"token operator\">></span> <span class=\"token number\">6</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"ONP\"</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"NA\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">reformat_aachange</span><span class=\"token punctuation\">(</span>input_string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    Reformat bcftools csq aminio acid change info to standard HGVSp format</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    Example: </pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    55HC>55HG to HC55HG </pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    253Y to Y253Y </pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    215E>215* to E215*</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    spl <span class=\"token operator\">=</span> input_string<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\">\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>spl<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        hgvsp <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">'[^A-Za-z]+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> spl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">'[^0-9]+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> spl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">'[0-9]+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> spl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        hgvsp <span class=\"token operator\">=</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">'[^A-Za-z]+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> spl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">'[^0-9]+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> spl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> re<span class=\"token punctuation\">.</span>sub<span class=\"token punctuation\">(</span><span class=\"token string\">'[^A-Za-z]+'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> spl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">return</span> hgvsp</pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">csq2maf</span><span class=\"token punctuation\">(</span>csq<span class=\"token punctuation\">,</span> tsb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    Takes bcftools csq formatted output and converts to maf</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    bcftools example command:</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    bcftools norm -f GRCh37.fa -m -both -Oz foo.vcf.gz | bcftools csq -c CSQ -f GRCh37.fa -g Homo_sapiens.GRCh37.82.gff3.gz -p a | bcftools +split-vep /dev/stdin -Oz -o foo.csq.vcf.gz -c - -s worst</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    bcftools query -f '%CHROM\\t%POS\\t%REF\\t%ALT\\t%gene\\t%transcript\\t%Consequence\\t%amino_acid_change\\t%dna_change\\n' foo.csq.vcf.gz > foo.csq.tsv</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    foo.csq.tsv would be the input</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    csq_to_vc_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"synonymous\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Silent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                      <span class=\"token string\">\"missense\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Missense_Mutation\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                      <span class=\"token string\">\"stop_lost\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Nonstop_Mutation\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                      <span class=\"token string\">\"stop_gained\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Nonsense_Mutation\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                      <span class=\"token string\">\"inframe_deletion\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"In_Frame_Del\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                      <span class=\"token string\">\"inframe_insertion\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"In_Frame_Ins\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                      <span class=\"token string\">\"frameshift\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"INDEL\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                      <span class=\"token string\">\"splice_acceptor\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Splice_Site\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                      <span class=\"token string\">\"splice_donor\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Splice_Site\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                      <span class=\"token string\">\"start_lost\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Translation_Start_Site\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                      <span class=\"token string\">\"splice_region\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Splice_Region\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                      <span class=\"token string\">\"stop_retained\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Silent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                      <span class=\"token string\">\"5_prime_utr\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5'UTR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                      <span class=\"token string\">\"3_prime_utr\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3'UTR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                      <span class=\"token string\">\"non_coding\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"RNA\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                      <span class=\"token string\">\"intron\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Intron\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                      <span class=\"token string\">\"intergenic\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"IGR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                      <span class=\"token string\">\"inframe_altering\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                      <span class=\"token string\">\"coding_sequence\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Missense_Mutation\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                      <span class=\"token string\">\"feature_elongation\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Targeted_Region\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                      <span class=\"token string\">\"start_retained\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Silent\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                      <span class=\"token string\">\".\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"IGR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                      <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>csq<span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> csq_file<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> csq_file<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>            line_spl <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>            variant_classification <span class=\"token operator\">=</span> csq_to_vc_dict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            <span class=\"token comment\"># Add Variant-type annotations based on the difference between ref and alt alleles</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            variant_type <span class=\"token operator\">=</span> get_variant_type<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> variant_classification<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>            <span class=\"token comment\"># Reformat amino acid change to HGVSp convention</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>            <span class=\"token keyword\">if</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                aachange <span class=\"token operator\">=</span> <span class=\"token string\">\"NA\"</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                aachange <span class=\"token operator\">=</span> reformat_aachange<span class=\"token punctuation\">(</span>line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>            <span class=\"token comment\"># Refgene in Unknonw if IGR or missing</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>            <span class=\"token keyword\">if</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NONE\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                refgene <span class=\"token operator\">=</span> <span class=\"token string\">\"Unknown\"</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                refgene <span class=\"token operator\">=</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>            maf <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>meta<span class=\"token punctuation\">,</span> refgene<span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                   line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> variant_classification<span class=\"token punctuation\">,</span> variant_type<span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> line_spl<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> aachange<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> maf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">parse_record</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> col_idx<span class=\"token punctuation\">,</span> col_idx_non<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    Convert an annovar line to MAF. Retain all other columns as is</pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token comment\"># Annovar to MAF mappings (http://annovar.openbioinformatics.org/en/latest/user-guide/gene/)</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    annovar_values <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        <span class=\"token string\">'exonic'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>        <span class=\"token string\">'splicing'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Splice_Site'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>        <span class=\"token string\">'UTR5'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5'UTR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>        <span class=\"token string\">'UTR3'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3'UTR\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>        <span class=\"token string\">'intronic'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Intron'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>        <span class=\"token string\">'upstream'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5'Flank\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>        <span class=\"token string\">'downstream'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3'Flank\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>        <span class=\"token string\">'intergenic'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'IGR'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>        <span class=\"token string\">'frameshift insertion'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Frame_Shift_Ins'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>        <span class=\"token string\">'frameshift deletion'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Frame_Shift_Del'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>        <span class=\"token string\">'frameshift block substitution'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Frameshift_INDEL'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>        <span class=\"token string\">'frameshift substitution'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Frameshift_INDEL'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>        <span class=\"token string\">'stopgain'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Nonsense_Mutation'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>        <span class=\"token string\">'stoploss'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Nonstop_Mutation'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>        <span class=\"token string\">'startloss'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Translation_Start_Site'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>        <span class=\"token string\">'startgain'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Unknown'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>        <span class=\"token string\">'nonframeshift insertion'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'In_Frame_Ins'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>        <span class=\"token string\">'nonframeshift deletion'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'In_Frame_Del'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>        <span class=\"token string\">'nonframeshift block substitution'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Inframe_INDEL'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>        <span class=\"token string\">'nonframeshift substitution'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Inframe_INDEL'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>        <span class=\"token string\">'nonsynonymous SNV'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Missense_Mutation'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>        <span class=\"token string\">'synonymous SNV'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Silent'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>        <span class=\"token string\">'unknown'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Unknown'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>        <span class=\"token string\">'ncRNA_exonic'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>        <span class=\"token string\">'ncRNA_intronic'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>        <span class=\"token string\">'ncRNA_UTR3'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>        <span class=\"token string\">'ncRNA_UTR5'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>        <span class=\"token string\">'ncRNA'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>        <span class=\"token string\">'ncRNA_splicing'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'RNA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>        <span class=\"token string\">'NA'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'NA'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>        <span class=\"token string\">'.'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'NA'</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"167\"></td><td><pre>    <span class=\"token comment\"># Take the fisrt functional entry</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>    linespl <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>    func_refgene <span class=\"token operator\">=</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Func.refGene\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>    func_refgene <span class=\"token operator\">=</span> func_refgene<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"172\"></td><td><pre>    <span class=\"token comment\">#Take the fisrt functional entry</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>    exonicFunc_refgene <span class=\"token operator\">=</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"ExonicFunc.refGene\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>    exonicFunc_refgene <span class=\"token operator\">=</span> exonicFunc_refgene<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"176\"></td><td><pre>    <span class=\"token comment\"># Refgene in Unknonw if IGR or missing</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>    refgene <span class=\"token operator\">=</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Gene.refGene\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>    refgene <span class=\"token operator\">=</span> refgene<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>    <span class=\"token keyword\">if</span> refgene <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NONE\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>        refgene <span class=\"token operator\">=</span> <span class=\"token string\">\"Unknown\"</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"182\"></td><td><pre>    <span class=\"token comment\">#Use first transcript changes by default</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>    aa_change <span class=\"token operator\">=</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"AAChange.refGene\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>    aa_change <span class=\"token operator\">=</span> aa_change<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>    aa_change <span class=\"token operator\">=</span> aa_change<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"187\"></td><td><pre>    <span class=\"token comment\"># \"Transcript_ID\", \"Exon_Number\", \"HGVSc\", \"HGVSp\"</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>aa_change<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>        aa_change <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>aa_change<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> aa_change<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> aa_change<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> aa_change<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>        aa_change <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"193\"></td><td><pre>    <span class=\"token keyword\">if</span> exonicFunc_refgene <span class=\"token operator\">==</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>        variant_classification <span class=\"token operator\">=</span> annovar_values<span class=\"token punctuation\">[</span>func_refgene<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>        variant_classification <span class=\"token operator\">=</span> annovar_values<span class=\"token punctuation\">[</span>exonicFunc_refgene<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"198\"></td><td><pre>    <span class=\"token comment\"># Add Variant-type annotations based on the difference between ref and alt alleles</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>    variant_type <span class=\"token operator\">=</span> get_variant_type<span class=\"token punctuation\">(</span>linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ref\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Alt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> variant_classification<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"201\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>refgene<span class=\"token punctuation\">,</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Chr\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"End\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"202\"></td><td><pre>           variant_classification<span class=\"token punctuation\">,</span> variant_type<span class=\"token punctuation\">,</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ref\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> linespl<span class=\"token punctuation\">[</span>col_idx<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"Alt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> aa_change</pre></td></tr><tr><td data-num=\"203\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"204\"></td><td><pre>    <span class=\"token keyword\">for</span> idx <span class=\"token keyword\">in</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>col_idx_non<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>linespl<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">>=</span> idx<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>            res<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>linespl<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>            res<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"210\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">'\\t'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre></pre></td></tr><tr><td data-num=\"212\"></td><td><pre></pre></td></tr><tr><td data-num=\"213\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">Diff</span><span class=\"token punctuation\">(</span>li1<span class=\"token punctuation\">,</span> li2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"215\"></td><td><pre>    Tiny function to diff two lists. From internet, dont remeber where unfortunately :\\</pre></td></tr><tr><td data-num=\"216\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>    li_dif <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>i <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> li1 <span class=\"token operator\">+</span> li2 <span class=\"token keyword\">if</span> i <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> li1 <span class=\"token keyword\">or</span> i <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> li2<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre>    <span class=\"token keyword\">return</span> li_dif</pre></td></tr><tr><td data-num=\"219\"></td><td><pre></pre></td></tr><tr><td data-num=\"220\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">read_annovar_file</span><span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span> protocol<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> annovar_file<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>        first_line <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>annovar_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"224\"></td><td><pre>        <span class=\"token keyword\">if</span> protocol <span class=\"token operator\">==</span> <span class=\"token string\">\"refGene\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre>            essential_cols <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Chr'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Start'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'End'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Ref'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Alt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Func.refGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Gene.refGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'GeneDetail.refGene'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre>                              <span class=\"token string\">'ExonicFunc.refGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AAChange.refGene'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre>            essential_cols <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Chr'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Start'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'End'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Ref'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Alt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Func.ensGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Gene.ensGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'GeneDetail.ensGene'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre>                              <span class=\"token string\">'ExonicFunc.ensGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AAChange.ensGene'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"231\"></td><td><pre>        nonessential_cols <span class=\"token operator\">=</span> Diff<span class=\"token punctuation\">(</span>first_line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> essential_cols<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"233\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"234\"></td><td><pre>        essential_cols_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>col<span class=\"token punctuation\">:</span> idx <span class=\"token keyword\">for</span> idx<span class=\"token punctuation\">,</span> col <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>first_line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> col <span class=\"token keyword\">in</span> essential_cols<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre>        nonessential_cols_dict <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>col<span class=\"token punctuation\">:</span> idx <span class=\"token keyword\">for</span> idx<span class=\"token punctuation\">,</span> col <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>first_line<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> col <span class=\"token keyword\">in</span> nonessential_cols<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"237\"></td><td><pre>        <span class=\"token comment\"># In case ensGene is used as a protocol, rename the keys to refGene to harmonise the input</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre>        <span class=\"token keyword\">if</span> protocol <span class=\"token operator\">==</span> <span class=\"token string\">\"ensGene\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre>            key_mapping <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">'Chr'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Chr'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Start'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Start'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'End'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'End'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Func.ensGene'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Func.refGene'</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"240\"></td><td><pre>                           <span class=\"token string\">'Gene.ensGene'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Gene.refGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'GeneDetail.ensGene'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GeneDetail.refGene'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre>                           <span class=\"token string\">'ExonicFunc.ensGene'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ExonicFunc.refGene'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AAChange.ensGene'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'AAChange.refGene'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>            <span class=\"token keyword\">for</span> old_key<span class=\"token punctuation\">,</span> new_key <span class=\"token keyword\">in</span> key_mapping<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>                essential_cols_dict<span class=\"token punctuation\">[</span>new_key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> essential_cols_dict<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span>old_key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>        hdr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Tumor_Sample_Barcode\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NCBI_Build\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Center\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hugo_Symbol\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Chromosome\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Start_Position\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"End_Position\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Variant_Classification\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Variant_Type\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>               <span class=\"token string\">\"Reference_Allele\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Tumor_Seq_Allele2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Transcript_ID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Exon_Number\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HGVSc\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HGVSp\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> nonessential_cols</pre></td></tr><tr><td data-num=\"247\"></td><td><pre></pre></td></tr><tr><td data-num=\"248\"></td><td><pre>        <span class=\"token keyword\">yield</span> <span class=\"token string\">'\\t'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>hdr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre></pre></td></tr><tr><td data-num=\"250\"></td><td><pre>        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> annovar_file<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"251\"></td><td><pre>            maf_line <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>meta<span class=\"token punctuation\">,</span> parse_record<span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> essential_cols_dict<span class=\"token punctuation\">,</span> nonessential_cols_dict<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"252\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> maf_line<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre>            </pre></td></tr><tr><td data-num=\"254\"></td><td><pre></pre></td></tr><tr><td data-num=\"255\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"256\"></td><td><pre>    parser <span class=\"token operator\">=</span> argparse<span class=\"token punctuation\">.</span>ArgumentParser<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"257\"></td><td><pre>        description<span class=\"token operator\">=</span><span class=\"token string\">\"Convert annovar and bcftools-csq annotations to MAF\"</span><span class=\"token punctuation\">,</span> prog<span class=\"token operator\">=</span><span class=\"token string\">\"annovar2maf\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"258\"></td><td><pre>    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"259\"></td><td><pre>        <span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Annovar anotations file [Ex: myanno.hg19_multianno.txt] or a csq formatted file.\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"260\"></td><td><pre>    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-t\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--tsb\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Sample name. Default parses from the file name\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"261\"></td><td><pre>    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre>        <span class=\"token string\">\"-b\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--build\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Reference genome build [Default: hg38]\"</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">\"hg38\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"263\"></td><td><pre>    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"264\"></td><td><pre>        <span class=\"token string\">\"-p\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--protocol\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Protocol used to generate annovar annotations [Default: refGene]\"</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">\"refGene\"</span><span class=\"token punctuation\">,</span> choices<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"refGene\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ensGene\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"265\"></td><td><pre>    parser<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre>        <span class=\"token string\">\"-c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--csq\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"Input file is a bcftools csq formatted output\"</span><span class=\"token punctuation\">,</span> action<span class=\"token operator\">=</span><span class=\"token string\">'store_true'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"267\"></td><td><pre></pre></td></tr><tr><td data-num=\"268\"></td><td><pre>    args <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span>parse_args<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre></pre></td></tr><tr><td data-num=\"270\"></td><td><pre>    <span class=\"token keyword\">if</span> args<span class=\"token punctuation\">.</span>tsb <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"271\"></td><td><pre>        tsb <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>basename<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"272\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre>        tsb <span class=\"token operator\">=</span> args<span class=\"token punctuation\">.</span>tsb</pre></td></tr><tr><td data-num=\"274\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"275\"></td><td><pre>    meta <span class=\"token operator\">=</span> <span class=\"token string\">'\\t'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span>tsb<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>build<span class=\"token punctuation\">,</span> <span class=\"token string\">\"NA\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"276\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"277\"></td><td><pre>    <span class=\"token keyword\">if</span> args<span class=\"token punctuation\">.</span>csq <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"278\"></td><td><pre>        hdr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Tumor_Sample_Barcode\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NCBI_Build\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Center\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hugo_Symbol\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Chromosome\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Start_Position\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"End_Position\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Variant_Classification\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Variant_Type\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"279\"></td><td><pre>           <span class=\"token string\">\"Reference_Allele\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Tumor_Seq_Allele2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Transcript_ID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HGVSc\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"amino_acid_change\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HGVSp\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\t'</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>hdr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"281\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"282\"></td><td><pre>        csq2maf<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">,</span> tsb<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"283\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre>        <span class=\"token keyword\">for</span> output_line <span class=\"token keyword\">in</span> read_annovar_file<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">.</span>protocol<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"285\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>output_line<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>此脚本会在第一列添加一列脚本自定义的  <code>Tumor_Sample_Barcode</code> ，使用以下命令去除：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cut</span> -f2- merged_annotations.maf <span class=\"token operator\">></span> merged_annotations_python.maf</pre></td></tr></table></figure><p>生成的  <code>merged_annotations_python.maf</code>  文件可以使用 R 语言的  <code>maftools</code>  包来直接进行分析和绘图</p>\n<h3 id=\"如果你的-annovar-注释结果比较少\"><a class=\"anchor\" href=\"#如果你的-annovar-注释结果比较少\">#</a> 如果你的 Annovar 注释结果比较少</h3>\n<p>我们可以使用 R 语言的  <code>maftools</code>  包来直接进行转换、分析和绘图：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>library<span class=\"token punctuation\">(</span>maftools<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 转换</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>var.annovar.maf <span class=\"token operator\">&lt;-</span> annovarToMaf<span class=\"token punctuation\">(</span>annovar <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"merged_annotations.csv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                                refBuild <span class=\"token operator\">=</span> <span class=\"token string\">'hg19'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                                tsbCol <span class=\"token operator\">=</span> <span class=\"token string\">'Sample'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                                table <span class=\"token operator\">=</span> <span class=\"token string\">'refGene'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                                sep <span class=\"token operator\">=</span> <span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>write.table<span class=\"token punctuation\">(</span>var.annovar.maf<span class=\"token punctuation\">,</span> file <span class=\"token operator\">=</span> <span class=\"token string\">\"merged_annotations_R.maf\"</span><span class=\"token punctuation\">,</span> quote <span class=\"token operator\">=</span> F<span class=\"token punctuation\">,</span> sep <span class=\"token operator\">=</span> <span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">,</span> row.names <span class=\"token operator\">=</span> F<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 绘图</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>var_maf <span class=\"token operator\">&lt;-</span> read.maf<span class=\"token punctuation\">(</span>maf <span class=\"token operator\">=</span> <span class=\"token string\">\"merged_annotations_R.maf\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>png<span class=\"token punctuation\">(</span>filename <span class=\"token operator\">=</span> <span class=\"token string\">\"WES_maf_summary.png\"</span><span class=\"token punctuation\">,</span> width <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> height <span class=\"token operator\">=</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> units <span class=\"token operator\">=</span> <span class=\"token string\">\"in\"</span><span class=\"token punctuation\">,</span> res <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>plotmafSummary<span class=\"token punctuation\">(</span>maf <span class=\"token operator\">=</span> var_maf<span class=\"token punctuation\">,</span> rmOutlier <span class=\"token operator\">=</span> <span class=\"token boolean\">TRUE</span><span class=\"token punctuation\">,</span> addStat <span class=\"token operator\">=</span> <span class=\"token string\">'median'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>dev.off<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>png<span class=\"token punctuation\">(</span>filename <span class=\"token operator\">=</span> <span class=\"token string\">\"WES_oncoplot.png\"</span><span class=\"token punctuation\">,</span> width <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span> height <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> units <span class=\"token operator\">=</span> <span class=\"token string\">\"in\"</span><span class=\"token punctuation\">,</span> res <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>oncoplot<span class=\"token punctuation\">(</span>maf <span class=\"token operator\">=</span> var_maf<span class=\"token punctuation\">,</span> top <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>dev.off<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>使用 R 包转换的文件会稍大一点，但是它们的绘图结果是一致的。</p>\n",
            "tags": [
                "R",
                "生信",
                "WES",
                "WGS"
            ]
        }
    ]
}