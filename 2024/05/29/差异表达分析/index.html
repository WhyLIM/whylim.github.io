<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="alternate" href="/rss.xml" title="Being on sea, sail; being on land, settle." type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Being on sea, sail; being on land, settle." type="application/atom+xml"><link rel="alternate" type="application/json" title="Being on sea, sail; being on land, settle." href="https://new.limina.top/feed.json"><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext" media="none" onload="this.media='all'"><link rel="stylesheet" href="/css/app.css?v=0.4.2"><link rel="modulepreload" href="/js/chunk-3VMQCGY7.js"><link rel="modulepreload" href="/js/chunk-GCFK3SZY.js"><link rel="modulepreload" href="/js/chunk-T7ALM2OC.js"><link rel="modulepreload" href="/js/index.esm-7BKIFL5P.js"><link rel="modulepreload" href="/js/post-NPGFUIAE.js"><link rel="modulepreload" href="/js/quicklink-QSFRKTHN.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href=":" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="g" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="n" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="b" as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="g" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="S" as="image" fetchpriority="high"><link rel="preload" href="u" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="_" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="f" as="image" fetchpriority="high"><link rel="preload" href="_" as="image" fetchpriority="high"><link rel="preload" href="R" as="image" fetchpriority="high"><link rel="preload" href="N" as="image" fetchpriority="high"><link rel="preload" href="A" as="image" fetchpriority="high"><link rel="preload" href="-" as="image" fetchpriority="high"><link rel="preload" href="S" as="image" fetchpriority="high"><link rel="preload" href="e" as="image" fetchpriority="high"><link rel="preload" href="q" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href="v" as="image" fetchpriority="high"><link rel="preload" href="g" as="image" fetchpriority="high"><meta name="keywords" content="R,RNA-Seq"><link rel="canonical" href="https://new.limina.top/2024/05/29/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/"><title>差异表达分析：使用 R 进行 RNA-Seq 数据分析</title><meta name="generator" content="Hexo 7.0.0"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">差异表达分析：使用 R 进行 RNA-Seq 数据分析</h1><div class="meta"><span class="item" title="创建时间：2024-05-29 20:31:49"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-05-29T20:31:49+08:00">2024-05-29</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>18k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>16 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">WhyLIM</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://img.limina.top/blog/Summary_of_RNA-Seq.svg" loading="eager" decoding="async" fetchpriority="high" alt="Being on sea, sail; being on land, settle."></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement="" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/R/" itemprop="item" rel="index" title="分类于R"><span itemprop="name">R<meta itemprop="position" content="0"></span></a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/R/%E7%94%9F%E4%BF%A1/" itemprop="item" rel="index" title="分类于生信"><span itemprop="name">生信<meta itemprop="position" content="1"></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/R/%E7%94%9F%E4%BF%A1/RNA-Seq/" itemprop="item" rel="index" title="分类于RNA-Seq"><span itemprop="name">RNA-Seq<meta itemprop="position" content="2"></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://new.limina.top/2024/05/29/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/"><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.png"><meta itemprop="name" content="WhyLIM"><meta itemprop="description" content="1 1 1 0 0 1 0 1 1, "></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Being on sea, sail; being on land, settle."></span><div class="body md" itemprop="articleBody"><h1 id="差异表达分析使用-r-进行-rna-seq-数据分析"><a class="anchor" href="#差异表达分析使用-r-进行-rna-seq-数据分析">#</a> 差异表达分析：使用 R 进行 RNA-Seq 数据分析</h1>
<blockquote>
<p>在现代生物学研究中，RNA-Seq（RNA 测序）已经成为解析基因表达的强大工具。差异表达分析是其中一个重要步骤，通过比较不同条件下的基因表达水平，我们可以找出哪些基因在不同的生物条件下表现出显著变化。</p>
</blockquote>
<p><img loading="lazy" data-src="https://img.limina.top/blog/Summary_of_RNA-Seq.svg" alt="Summary_of_RNA-Seq" title="By Thomas Shafee - Own work, CC BY 4.0, https://commons.wikimedia.org/w/index.php?curid=52065926"></p>
<h2 id="差异表达分析"><a class="anchor" href="#差异表达分析">#</a> 差异表达分析</h2>
<p>差异表达分析（Differential Expression Analysis）是指通过比较不同条件或处理下的基因表达水平，找出那些显著变化的基因。这些基因的变化可能与某些生物学过程、疾病状态或环境响应有关。</p>
<h2 id="使用的软件包"><a class="anchor" href="#使用的软件包">#</a> 使用的软件包</h2>
<ul>
<li><code>limma</code> ：用于线性模型拟合和差异表达分析。</li>
<li><code>edgeR</code> ：用于 RNA-Seq 数据的标准化和处理。</li>
<li><code>dplyr</code> ：用于数据操作。</li>
</ul>
<h2 id="函数实现"><a class="anchor" href="#函数实现">#</a> 函数实现</h2>
<p>在此我们将构建一个名为  <code>runLimma</code>  的函数，该函数的输入参数为：</p>
<ul>
<li>表达矩阵（ <code>exp</code> ）</li>
<li>样本分组信息（ <code>group</code> ）</li>
<li>是否执行标准化（ <code>normalize</code> ）</li>
<li>是否生成有方向的对比（ <code>directional</code> ）</li>
</ul>
<p>其能够：</p>
<ul>
<li>处理 RNA-Seq 数据的归一化</li>
<li>生成详细的结果总结</li>
<li>自动生成所有可能的对比矩阵，考虑所有组别之间的对比</li>
</ul>
<p>让我们一步步讲解这个函数是如何工作的。</p>
<h3 id="数据准备和输入"><a class="anchor" href="#数据准备和输入">#</a> 数据准备和输入</h3>
<p>首先，我们需要准备两个输入：</p>
<ul>
<li><code>exp</code> ：表达矩阵，行代表基因，列代表样本。</li>
<li><code>group</code> ：分组信息，每个样本对应一个实验条件或组别。</li>
</ul>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>runLimma <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>exp<span class="token punctuation">,</span> group<span class="token punctuation">,</span> normalize <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> directional <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  library<span class="token punctuation">(</span>limma<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  library<span class="token punctuation">(</span>edgeR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h3 id="分组信息和设计矩阵"><a class="anchor" href="#分组信息和设计矩阵">#</a> 分组信息和设计矩阵</h3>
<p>我们将分组信息转换为因子向量，并创建设计矩阵。设计矩阵用于描述实验的设计和条件，告诉我们哪些样本属于哪一组。</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># 分组信息变为因子向量</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  conditions <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>group<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment"># 设计矩阵</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  design <span class="token operator">&lt;-</span> model.matrix<span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">0</span> <span class="token operator">+</span> conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  colnames<span class="token punctuation">(</span>design<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> levels<span class="token punctuation">(</span>conditions<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h3 id="rna-seq-数据归一化"><a class="anchor" href="#rna-seq-数据归一化">#</a> RNA-Seq 数据归一化</h3>
<p>RNA-Seq 数据通常需要标准化，以便减少技术变异的影响，使不同样本之间的基因表达水平可以更准确地比较。但是如果数据已经经过了标准化，我们可以跳过这一步：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># RNA-Seq 数据归一化</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>normalize<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    dge <span class="token operator">&lt;-</span> DGEList<span class="token punctuation">(</span>counts <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>exp<span class="token punctuation">)</span><span class="token punctuation">,</span> group <span class="token operator">=</span> conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    dge <span class="token operator">&lt;-</span> calcNormFactors<span class="token punctuation">(</span>dge<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    v <span class="token operator">&lt;-</span> voom<span class="token punctuation">(</span>dge<span class="token punctuation">,</span> design<span class="token punctuation">,</span> plot <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    exprs <span class="token operator">&lt;-</span> v<span class="token operator">$</span>E</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    exprs <span class="token operator">&lt;-</span> as.matrix<span class="token punctuation">(</span>exp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>这里我们使用  <code>edgeR</code>  包中的  <code>DGEList</code>  和  <code>calcNormFactors</code>  函数对数据进行标准化处理。 <code>voom</code>  函数进一步处理数据，使其适用于线性模型分析。</p>
<h3 id="线性模型和经验贝叶斯分析"><a class="anchor" href="#线性模型和经验贝叶斯分析">#</a> 线性模型和经验贝叶斯分析</h3>
<p>接下来，我们使用  <code>lmFit</code>  和  <code>eBayes</code>  函数进行线性模型拟合和贝叶斯统计。这一步帮助我们找到在不同组别间显著变化的基因。</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># 线性模型和经验贝叶斯</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  fit <span class="token operator">&lt;-</span> lmFit<span class="token punctuation">(</span>exprs<span class="token punctuation">,</span> design<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  fit <span class="token operator">&lt;-</span> eBayes<span class="token punctuation">(</span>fit<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h3 id="生成对比矩阵"><a class="anchor" href="#生成对比矩阵">#</a> 生成对比矩阵</h3>
<p>我们自动生成所有可能的对比矩阵，考虑所有组别之间的对比。</p>
<p>对比矩阵帮助我们定义哪些组别之间进行比较。</p>
<p>如果  <code>directional</code>  设置为  <code>TRUE</code> ，函数会生成双向对比（例如  <code>N-T</code>  和  <code>T-N</code> ），否则只生成一个方向的对比（可能是  <code>N-T</code>  或  <code>T-N</code> ）。</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># 自动生成所有可能的对比矩阵</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  unique_conditions <span class="token operator">&lt;-</span> levels<span class="token punctuation">(</span>conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  num_conditions <span class="token operator">&lt;-</span> length<span class="token punctuation">(</span>unique_conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  contrast_str <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">(</span>num_conditions <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token keyword">in</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>num_conditions<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      contrast_name <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>unique_conditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> unique_conditions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      contrast_str <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>contrast_str<span class="token punctuation">,</span> contrast_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>directional<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        contrast_name_reverse <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>unique_conditions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> unique_conditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        contrast_str <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>contrast_str<span class="token punctuation">,</span> contrast_name_reverse<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  contrasts <span class="token operator">&lt;-</span> makeContrasts<span class="token punctuation">(</span>contrasts <span class="token operator">=</span> contrast_str<span class="token punctuation">,</span> levels <span class="token operator">=</span> colnames<span class="token punctuation">(</span>design<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h3 id="应用对比矩阵并生成详细结果"><a class="anchor" href="#应用对比矩阵并生成详细结果">#</a> 应用对比矩阵并生成详细结果</h3>
<p>使用生成的对比矩阵，我们可以对数据进行差异表达分析，并生成详细的结果总结，包括每个对比下的显著变化基因及其调控方向（上调或下调）。</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># 应用对比矩阵</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  fit2 <span class="token operator">&lt;-</span> contrasts.fit<span class="token punctuation">(</span>fit<span class="token punctuation">,</span> contrasts<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  fit2 <span class="token operator">&lt;-</span> eBayes<span class="token punctuation">(</span>fit2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  </pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment"># 生成详细的结果总结</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  summary_results <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span>contrast_name <span class="token keyword">in</span> contrast_str<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    tT <span class="token operator">&lt;-</span> topTable<span class="token punctuation">(</span>fit2<span class="token punctuation">,</span> coef <span class="token operator">=</span> contrast_name<span class="token punctuation">,</span> adjust <span class="token operator">=</span> <span class="token string">"fdr"</span><span class="token punctuation">,</span> sort.by <span class="token operator">=</span> <span class="token string">"B"</span><span class="token punctuation">,</span> number <span class="token operator">=</span> nrow<span class="token punctuation">(</span>exprs<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    regulated <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Up"</span><span class="token punctuation">,</span> <span class="token string">"Down"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    tT<span class="token operator">$</span>Regulation <span class="token operator">&lt;-</span> regulated</pre></td></tr><tr><td data-num="11"></td><td><pre>    lfcs <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>log2<span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log2<span class="token punctuation">(</span><span class="token number">1.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log2<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    all.deg.cnt <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>lfc <span class="token keyword">in</span> lfcs<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      deg1 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      deg2 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> <span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      deg3 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      deg4 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      deg5 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> <span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      all.deg.cnt <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>all.deg.cnt<span class="token punctuation">,</span> c<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg1 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg1 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg2 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg2 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg3 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg3 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg4 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg4 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg5 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg5 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    row.names<span class="token punctuation">(</span>all.deg.cnt<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"p&lt;0.05"</span><span class="token punctuation">,</span> <span class="token string">"p&lt;0.01"</span><span class="token punctuation">,</span> <span class="token string">"FDR&lt;0.1"</span><span class="token punctuation">,</span> <span class="token string">"FDR&lt;0.05"</span><span class="token punctuation">,</span> <span class="token string">"FDR&lt;0.01"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    colnames<span class="token punctuation">(</span>all.deg.cnt<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"1.2"</span><span class="token punctuation">,</span> <span class="token string">"1.3"</span><span class="token punctuation">,</span> <span class="token string">"1.5"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"-fold"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    summary_results<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>DEG <span class="token operator">=</span> tT<span class="token punctuation">,</span> Summary <span class="token operator">=</span> all.deg.cnt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  </pre></td></tr><tr><td data-num="32"></td><td><pre>  results <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    CombinedFit <span class="token operator">=</span> fit2<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    DetailedResults <span class="token operator">=</span> summary_results</pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  return<span class="token punctuation">(</span>results<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><h3 id="提取结果"><a class="anchor" href="#提取结果">#</a> 提取结果</h3>
<p><code>getSummary</code>  函数用于打印某个对比的总结信息。</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>getSummary <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> contrast_name<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>contrast_name <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>results<span class="token operator">$</span>DetailedResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"The specified contrast is not found in the results."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre>  summary <span class="token operator">&lt;-</span> results<span class="token operator">$</span>DetailedResults<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">$</span>Summary</pre></td></tr><tr><td data-num="7"></td><td><pre>  print<span class="token punctuation">(</span>summary<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p><code>getDEGs</code>  函数用于根据指定的 p-value 阈值（默认 0.05）、指定的 fdr 阈值（默认 0.05）和 logFC 阈值（默认 1）获取某个对比中的差异表达基因。</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>getDEGs <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> contrast_name<span class="token punctuation">,</span> pvalue_threshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> fdr_threshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> logFC_threshold <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>contrast_name <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>results<span class="token operator">$</span>DetailedResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"The specified contrast is not found in the results."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre>  tT <span class="token operator">&lt;-</span> results<span class="token operator">$</span>DetailedResults<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">$</span>DEG</pre></td></tr><tr><td data-num="7"></td><td><pre>  degs <span class="token operator">&lt;-</span> tT<span class="token punctuation">[</span>which<span class="token punctuation">(</span>tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> pvalue_threshold <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> fdr_threshold <span class="token operator">&amp;</span> abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> logFC_threshold<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  return<span class="token punctuation">(</span>degs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>为了获取所有基因来绘制火山图，我们可以对此函数稍作修改：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>getDEGs <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> contrast_name<span class="token punctuation">,</span> pvalue_threshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> fdr_threshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> logFC_threshold <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>contrast_name <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>results<span class="token operator">$</span>DetailedResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"The specified contrast is not found in the results."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre>  tT <span class="token operator">&lt;-</span> results<span class="token operator">$</span>DetailedResults<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">$</span>DEG</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>is.null<span class="token punctuation">(</span>pvalue_threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> is.null<span class="token punctuation">(</span>fdr_threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> is.null<span class="token punctuation">(</span>logFC_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    degs <span class="token operator">&lt;-</span> tT</pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    degs <span class="token operator">&lt;-</span> tT<span class="token punctuation">[</span>tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> pvalue_threshold <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> fdr_threshold <span class="token operator">&amp;</span> abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> logFC_threshold<span class="token punctuation">,</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  </pre></td></tr><tr><td data-num="13"></td><td><pre>  return<span class="token punctuation">(</span>degs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>当  <code>pvalue_threshold == fdr_threshold == logFC_threshold == NULL</code>  时，获取所有的基因</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>allGenes <span class="token operator">&lt;-</span> getDEGs<span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token string">"T-N"</span><span class="token punctuation">,</span> pvalue_threshold <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> fdr_threshold <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> logFC_threshold <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><h3 id="绘制火山图"><a class="anchor" href="#绘制火山图">#</a> 绘制火山图</h3>
<p><code>limma</code>  包的分析结果中，虽然最后一列  <code>Regulation</code>  已经标注了基因的上下调信息，但它仅仅是根据  <code>logFC</code>  列的正负来标注的，所以我们新建一列重新标注：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>allGenes <span class="token operator">&lt;-</span> getDEGs<span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token string">"T-N"</span><span class="token punctuation">,</span> pvalue_threshold <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> fdr_threshold <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> logFC_threshold <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>significance <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span><span class="token punctuation">(</span>allGenes<span class="token operator">$</span>`adj.P.Val` <span class="token operator">&lt;</span> <span class="token number">0.05</span> <span class="token operator">&amp;</span> abs<span class="token punctuation">(</span>allGenes<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ifelse<span class="token punctuation">(</span>allGenes<span class="token operator">$</span>logFC <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Up"</span><span class="token punctuation">,</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NS"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>allGenes<span class="token operator">$</span>Significance <span class="token operator">&lt;-</span> significance</pre></td></tr></tbody></table></figure><p>使用  <code>ggplot2</code>  绘图：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>ggplot<span class="token punctuation">(</span>allGenes<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>logFC<span class="token punctuation">,</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span>adj.P.Val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  geom_point<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>col <span class="token operator">=</span> Significance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  scale_color_manual<span class="token punctuation">(</span>values<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">"#0072B5"</span><span class="token punctuation">,</span> <span class="token string">"grey"</span><span class="token punctuation">,</span> <span class="token string">"#BC3C28"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  labs<span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  geom_vline<span class="token punctuation">(</span>xintercept <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  geom_hline<span class="token punctuation">(</span>yintercept <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  theme<span class="token punctuation">(</span>plot.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> face <span class="token operator">=</span> <span class="token string">"bold"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  labs<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token string">"log2(FoldChange)"</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">"-log10(Pvalue)"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  theme<span class="token punctuation">(</span>axis.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  theme_bw<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>ggsave<span class="token punctuation">(</span><span class="token string">"DEGs.png"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> dpi <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>也可以写成函数：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>volcanoPlot <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> logFC_col<span class="token punctuation">,</span> pvalue_col<span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"Volcano Plot"</span><span class="token punctuation">,</span> significance_col <span class="token operator">=</span> <span class="token string">"Significance"</span><span class="token punctuation">,</span> colors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"#0072B5"</span><span class="token punctuation">,</span> <span class="token string">"grey"</span><span class="token punctuation">,</span> <span class="token string">"#BC3C28"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># 检查颜色向量长度</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>length<span class="token punctuation">(</span>colors<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"Please provide exactly three colors."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  </pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment"># 将列名字符串转换为 symbols</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  log2FC_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>logFC_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  pvalue_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>pvalue_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  significance_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>significance_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    </pre></td></tr><tr><td data-num="12"></td><td><pre>  mytheme <span class="token operator">&lt;-</span> theme_bw<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>    theme<span class="token punctuation">(</span>plot.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> face <span class="token operator">=</span> <span class="token string">"bold"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>          axis.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="15"></td><td><pre>          axis.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    </pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token comment"># 绘图</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  ggplot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>log2FC_sym<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>pvalue_sym<span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>significance_sym<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    geom_point<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    scale_color_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> colors<span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    labs<span class="token punctuation">(</span>title <span class="token operator">=</span> title<span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token string">"log2(FoldChange)"</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">"-log10(Pvalue)"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    geom_vline<span class="token punctuation">(</span>xintercept <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    geom_hline<span class="token punctuation">(</span>yintercept <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    mytheme</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>volcanoPlot<span class="token punctuation">(</span>allGenes<span class="token punctuation">,</span> logFC_col <span class="token operator">=</span> <span class="token string">"logFC"</span><span class="token punctuation">,</span> pvalue_col <span class="token operator">=</span> <span class="token string">"adj.P.Val"</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><details class="info"><summary>关于 sym() 和 !! 的用法</summary><div>
<p>在 R 语言中， <code>sym()</code>  和  <code>!!</code>  这两个概念属于非标准评估（non-standard evaluation, NSE）的范畴，这是一个非常强大但稍显复杂的主题，特别是在处理动态变量名时非常有用。</p>
<ol>
<li><code>sym()</code>  函数</li>
</ol>
<p><code>sym()</code>  函数是  <code>rlang</code>  包提供的一个工具，用于将字符串转换为符号（symbol）。在 R 中，符号是一种对象类型，用于在表达式中代表变量名。</p>
<ul>
<li><strong>用途</strong>：当你需要将字符串动态转换为可以由函数理解的变量名时， <code>sym()</code>  就非常有用。例如，如果你有一个变量的名称存储为字符串，而你需要用这个变量名在  <code>ggplot2</code>  或  <code>dplyr</code>  的函数中指定数据列，这时就需要用到  <code>sym()</code> 。</li>
</ul>
<ol start="2">
<li><code>!!</code>  运算符（读作 “bang-bang”）</li>
</ol>
<p><code>!!</code>  是  <code>rlang</code>  包中的一个运算符，用于在函数内部 <code>强制展开</code> 符号，使其在表达式中被当作实际的变量名处理。</p>
<ul>
<li><strong>用途</strong>： <code>!!</code>  使得你可以在编写通用函数或包含变量输入的函数时，将符号作为实际的变量名在表达式中使用。这在使用如  <code>ggplot2</code> 、 <code>dplyr</code>  等包进行编程时尤其有用，因为这些包经常使用非标准评估。</li>
</ul>
<ol start="3">
<li>示例</li>
</ol>
<p>假设你有一个数据框  <code>df</code> ，并且你想根据用户的输入来选择哪一列进行操作。用户的输入是一个字符串，如  <code>"height"</code> 。你不能直接在如  <code>ggplot</code>  或  <code>dplyr</code>  的函数中使用  <code>"height"</code>  字符串，因为这些函数期望的是列名，而不是包含列名的字符串。这时，你可以使用  <code>sym()</code>  和  <code>!!</code> ：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>library<span class="token punctuation">(</span>rlang<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 假设的数据框和用户输入</span></pre></td></tr><tr><td data-num="6"></td><td><pre>df <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>height <span class="token operator">=</span> rnorm<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weight <span class="token operator">=</span> rnorm<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>column_name <span class="token operator">&lt;-</span> <span class="token string">"height"</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 使用 sym () 和！！来动态选择列</span></pre></td></tr><tr><td data-num="10"></td><td><pre>height_symbol <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>  <span class="token comment"># 将字符串转换为符号</span></pre></td></tr><tr><td data-num="11"></td><td><pre>df <span class="token percent-operator operator">%&gt;%</span> summarise<span class="token punctuation">(</span>Average <span class="token operator">=</span> mean<span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>height_symbol<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 使用！！来展开符号</span></pre></td></tr></tbody></table></figure><p>在这个例子中：</p>
<ul>
<li><code>sym(column_name)</code>  将字符串  <code>"height"</code>  转换为符号  <code>height</code> 。</li>
<li><code>!!height_symbol</code>  在  <code>summarise()</code>  函数中将符号  <code>height</code>  展开为实际的列名。</li>
</ul>
<p>这样，你就可以根据字符串变量动态地引用数据框中的列，而无需硬编码列名。这对于编写灵活且可重用的数据处理和可视化代码非常重要。</p>
</div></details>
<p>如果我们想为一些基因添加注释，可以使用  <code>geom_label()</code>  或  <code>geom_text()</code>  添加注释图层，这两个函数的区别在于， <code>geom_text()</code>  将文本直接叠加到图像中，而  <code>geom_label()</code>  添加的文本有一个矩形框背景，可以更好地提升文本的可读性。</p>
<p>但是在实际的应用中，由于标签重叠等问题，更常用的是  <code>ggrepel</code>  包中的  <code>geom_label_repel()</code>  或  <code>geom_text_repel()</code>  函数：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>install.packages<span class="token punctuation">(</span><span class="token string">"ggrepel"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>library<span class="token punctuation">(</span>ggrepel<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>修改后的  <code>volcanoPlot()</code>  函数：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>volcanoPlot <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> logFC_col<span class="token punctuation">,</span> pvalue_col<span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"Volcano Plot"</span><span class="token punctuation">,</span> significance_col <span class="token operator">=</span> <span class="token string">"Significance"</span><span class="token punctuation">,</span> colors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"#0072B5"</span><span class="token punctuation">,</span> <span class="token string">"grey"</span><span class="token punctuation">,</span> <span class="token string">"#BC3C28"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># 检查颜色向量长度</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>length<span class="token punctuation">(</span>colors<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"Please provide exactly three colors."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  </pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment"># 将列名字符串转换为 symbols</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  log2FC_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>logFC_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  pvalue_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>pvalue_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  significance_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>significance_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment"># 如果提供了 labels，添加一个新列用于标注</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.null<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    data<span class="token operator">$</span>Label <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>rownames<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token percent-operator operator">%in%</span> labels<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    data<span class="token operator">$</span>Label <span class="token operator">&lt;-</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  </pre></td></tr><tr><td data-num="19"></td><td><pre>  mytheme <span class="token operator">&lt;-</span> theme_bw<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="20"></td><td><pre>    theme<span class="token punctuation">(</span>plot.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> face <span class="token operator">=</span> <span class="token string">"bold"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>          axis.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="22"></td><td><pre>          axis.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  </pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token comment"># 绘图</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  p <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>log2FC_sym<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>pvalue_sym<span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>significance_sym<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    geom_point<span class="token punctuation">(</span>alpha <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="27"></td><td><pre>    guides<span class="token punctuation">(</span>color <span class="token operator">=</span> guide_legend<span class="token punctuation">(</span>override.aes <span class="token operator">=</span> list<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    scale_color_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> colors<span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    labs<span class="token punctuation">(</span>title <span class="token operator">=</span> title<span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token string">"log2(FoldChange)"</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">"-log10(Pvalue)"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    geom_vline<span class="token punctuation">(</span>xintercept <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    geom_hline<span class="token punctuation">(</span>yintercept <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    mytheme</pre></td></tr><tr><td data-num="33"></td><td><pre>  </pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token comment"># 如果有标签，添加标签</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.null<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    p <span class="token operator">&lt;-</span> p <span class="token operator">+</span> geom_text_repel<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span> ifelse<span class="token punctuation">(</span>Label <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> rownames<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>                             arrow <span class="token operator">=</span> arrow<span class="token punctuation">(</span>ends<span class="token operator">=</span><span class="token string">"first"</span><span class="token punctuation">,</span> length <span class="token operator">=</span> unit<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token string">"npc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> show.legend <span class="token operator">=</span> F<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  </pre></td></tr><tr><td data-num="40"></td><td><pre>  return<span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><h3 id="完整代码"><a class="anchor" href="#完整代码">#</a> 完整代码</h3>
<p>下面是完整的函数代码：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>library<span class="token punctuation">(</span>readxl<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>library<span class="token punctuation">(</span>limma<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>library<span class="token punctuation">(</span>edgeR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>library<span class="token punctuation">(</span>ggrepel<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>library<span class="token punctuation">(</span>rlang<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 执行差异表达分析的函数</span></pre></td></tr><tr><td data-num="10"></td><td><pre>runLimma <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>exp<span class="token punctuation">,</span> group<span class="token punctuation">,</span> normalize <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> directional <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment"># 分组信息变为因子向量</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  conditions <span class="token operator">&lt;-</span> factor<span class="token punctuation">(</span>group<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment"># 设计矩阵</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  design <span class="token operator">&lt;-</span> model.matrix<span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">0</span> <span class="token operator">+</span> conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  colnames<span class="token punctuation">(</span>design<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> levels<span class="token punctuation">(</span>conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  </pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>normalize<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># RNA-Seq 数据归一化</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    dge <span class="token operator">&lt;-</span> DGEList<span class="token punctuation">(</span>counts <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>exp<span class="token punctuation">)</span><span class="token punctuation">,</span> group <span class="token operator">=</span> conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    dge <span class="token operator">&lt;-</span> calcNormFactors<span class="token punctuation">(</span>dge<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    v <span class="token operator">&lt;-</span> voom<span class="token punctuation">(</span>dge<span class="token punctuation">,</span> design<span class="token punctuation">,</span> plot <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    exprs <span class="token operator">&lt;-</span> v<span class="token operator">$</span>E</pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    exprs <span class="token operator">&lt;-</span> as.matrix<span class="token punctuation">(</span>exp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  </pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token comment"># 线性模型和经验贝叶斯</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  fit <span class="token operator">&lt;-</span> lmFit<span class="token punctuation">(</span>exprs<span class="token punctuation">,</span> design<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  fit <span class="token operator">&lt;-</span> eBayes<span class="token punctuation">(</span>fit<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  </pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token comment"># 自动生成所有可能的对比矩阵</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  unique_conditions <span class="token operator">&lt;-</span> levels<span class="token punctuation">(</span>conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  num_conditions <span class="token operator">&lt;-</span> length<span class="token punctuation">(</span>unique_conditions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  contrast_str <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">(</span>num_conditions <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token keyword">in</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>num_conditions<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="38"></td><td><pre>      contrast_name <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>unique_conditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> unique_conditions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      contrast_str <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>contrast_str<span class="token punctuation">,</span> contrast_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>directional<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        contrast_name_reverse <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>unique_conditions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> unique_conditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        contrast_str <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>contrast_str<span class="token punctuation">,</span> contrast_name_reverse<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  contrasts <span class="token operator">&lt;-</span> makeContrasts<span class="token punctuation">(</span>contrasts <span class="token operator">=</span> contrast_str<span class="token punctuation">,</span> levels <span class="token operator">=</span> colnames<span class="token punctuation">(</span>design<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  </pre></td></tr><tr><td data-num="48"></td><td><pre>  fit2 <span class="token operator">&lt;-</span> contrasts.fit<span class="token punctuation">(</span>fit<span class="token punctuation">,</span> contrasts<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  fit2 <span class="token operator">&lt;-</span> eBayes<span class="token punctuation">(</span>fit2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  </pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token comment"># 生成详细的结果总结</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  summary_results <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span>contrast_name <span class="token keyword">in</span> contrast_str<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    tT <span class="token operator">&lt;-</span> topTable<span class="token punctuation">(</span>fit2<span class="token punctuation">,</span> coef <span class="token operator">=</span> contrast_name<span class="token punctuation">,</span> adjust <span class="token operator">=</span> <span class="token string">"fdr"</span><span class="token punctuation">,</span> sort.by <span class="token operator">=</span> <span class="token string">"B"</span><span class="token punctuation">,</span> number <span class="token operator">=</span> nrow<span class="token punctuation">(</span>exprs<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    regulated <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Up"</span><span class="token punctuation">,</span> <span class="token string">"Down"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    tT<span class="token operator">$</span>Regulation <span class="token operator">&lt;-</span> regulated</pre></td></tr><tr><td data-num="57"></td><td><pre>    lfcs <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>log2<span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log2<span class="token punctuation">(</span><span class="token number">1.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> log2<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    all.deg.cnt <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>lfc <span class="token keyword">in</span> lfcs<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="60"></td><td><pre>      deg1 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="61"></td><td><pre>      deg2 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> <span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="62"></td><td><pre>      deg3 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="63"></td><td><pre>      deg4 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="64"></td><td><pre>      deg5 <span class="token operator">&lt;-</span> regulated<span class="token punctuation">[</span>which<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> lfc <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> <span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="65"></td><td><pre>      all.deg.cnt <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>all.deg.cnt<span class="token punctuation">,</span> c<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg1 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg1 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg2 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg2 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg3 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg3 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg4 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg4 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        paste0<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>deg5 <span class="token operator">==</span> <span class="token string">"Up"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"|"</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>deg5 <span class="token operator">==</span> <span class="token string">"Down"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>      <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    row.names<span class="token punctuation">(</span>all.deg.cnt<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"p&lt;0.05"</span><span class="token punctuation">,</span> <span class="token string">"p&lt;0.01"</span><span class="token punctuation">,</span> <span class="token string">"FDR&lt;0.1"</span><span class="token punctuation">,</span> <span class="token string">"FDR&lt;0.05"</span><span class="token punctuation">,</span> <span class="token string">"FDR&lt;0.01"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    colnames<span class="token punctuation">(</span>all.deg.cnt<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> paste0<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"1.2"</span><span class="token punctuation">,</span> <span class="token string">"1.3"</span><span class="token punctuation">,</span> <span class="token string">"1.5"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"-fold"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    summary_results<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span>DEG <span class="token operator">=</span> tT<span class="token punctuation">,</span> Summary <span class="token operator">=</span> all.deg.cnt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="77"></td><td><pre>  </pre></td></tr><tr><td data-num="78"></td><td><pre>  results <span class="token operator">&lt;-</span> list<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    CombinedFit <span class="token operator">=</span> fit2<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    DetailedResults <span class="token operator">=</span> summary_results</pre></td></tr><tr><td data-num="81"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>  return<span class="token punctuation">(</span>results<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="84"></td><td><pre></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token comment"># 获得总结的函数</span></pre></td></tr><tr><td data-num="86"></td><td><pre>getSummary <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> contrast_name<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>contrast_name <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>results<span class="token operator">$</span>DetailedResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"The specified contrast is not found in the results."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="89"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="90"></td><td><pre>  </pre></td></tr><tr><td data-num="91"></td><td><pre>  summary <span class="token operator">&lt;-</span> results<span class="token operator">$</span>DetailedResults<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">$</span>Summary</pre></td></tr><tr><td data-num="92"></td><td><pre>  print<span class="token punctuation">(</span>summary<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token comment"># 获得差异基因的函数</span></pre></td></tr><tr><td data-num="96"></td><td><pre>getDEGs <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> contrast_name<span class="token punctuation">,</span> pvalue_threshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> fdr_threshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> logFC_threshold <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="97"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>contrast_name <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>results<span class="token operator">$</span>DetailedResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"The specified contrast is not found in the results."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="100"></td><td><pre>  </pre></td></tr><tr><td data-num="101"></td><td><pre>  tT <span class="token operator">&lt;-</span> results<span class="token operator">$</span>DetailedResults<span class="token punctuation">[</span><span class="token punctuation">[</span>contrast_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">$</span>DEG</pre></td></tr><tr><td data-num="102"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>is.null<span class="token punctuation">(</span>pvalue_threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> is.null<span class="token punctuation">(</span>fdr_threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> is.null<span class="token punctuation">(</span>logFC_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="103"></td><td><pre>    degs <span class="token operator">&lt;-</span> tT</pre></td></tr><tr><td data-num="104"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="105"></td><td><pre>    degs <span class="token operator">&lt;-</span> tT<span class="token punctuation">[</span>tT<span class="token operator">$</span>P.Value <span class="token operator">&lt;</span> pvalue_threshold <span class="token operator">&amp;</span> tT<span class="token operator">$</span>adj.P.Val <span class="token operator">&lt;</span> fdr_threshold <span class="token operator">&amp;</span> abs<span class="token punctuation">(</span>tT<span class="token operator">$</span>logFC<span class="token punctuation">)</span> <span class="token operator">&gt;</span> logFC_threshold<span class="token punctuation">,</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="106"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="107"></td><td><pre>  </pre></td></tr><tr><td data-num="108"></td><td><pre>  return<span class="token punctuation">(</span>degs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="110"></td><td><pre></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token comment"># 绘制火山图的函数</span></pre></td></tr><tr><td data-num="112"></td><td><pre>volcanoPlot <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> logFC_col<span class="token punctuation">,</span> pvalue_col<span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"Volcano Plot"</span><span class="token punctuation">,</span> significance_col <span class="token operator">=</span> <span class="token string">"Significance"</span><span class="token punctuation">,</span> colors <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"#0072B5"</span><span class="token punctuation">,</span> <span class="token string">"grey"</span><span class="token punctuation">,</span> <span class="token string">"#BC3C28"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="113"></td><td><pre>  <span class="token comment"># 检查颜色向量长度</span></pre></td></tr><tr><td data-num="114"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>length<span class="token punctuation">(</span>colors<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="115"></td><td><pre>    stop<span class="token punctuation">(</span><span class="token string">"Please provide exactly three colors."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="116"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="117"></td><td><pre>  </pre></td></tr><tr><td data-num="118"></td><td><pre>  <span class="token comment"># 将列名字符串转换为 symbols</span></pre></td></tr><tr><td data-num="119"></td><td><pre>  log2FC_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>logFC_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="120"></td><td><pre>  pvalue_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>pvalue_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre>  significance_sym <span class="token operator">&lt;-</span> sym<span class="token punctuation">(</span>significance_col<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="122"></td><td><pre>  </pre></td></tr><tr><td data-num="123"></td><td><pre>  <span class="token comment"># 如果提供了 labels，添加一个新列用于标注</span></pre></td></tr><tr><td data-num="124"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.null<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="125"></td><td><pre>    data<span class="token operator">$</span>Label <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>rownames<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token percent-operator operator">%in%</span> labels<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="126"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="127"></td><td><pre>    data<span class="token operator">$</span>Label <span class="token operator">&lt;-</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="128"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="129"></td><td><pre>  </pre></td></tr><tr><td data-num="130"></td><td><pre>  mytheme <span class="token operator">&lt;-</span> theme_bw<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="131"></td><td><pre>    theme<span class="token punctuation">(</span>plot.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> face <span class="token operator">=</span> <span class="token string">"bold"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="132"></td><td><pre>          axis.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="133"></td><td><pre>          axis.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>  </pre></td></tr><tr><td data-num="135"></td><td><pre>  <span class="token comment"># 绘图</span></pre></td></tr><tr><td data-num="136"></td><td><pre>  p <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>log2FC_sym<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>pvalue_sym<span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>significance_sym<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="137"></td><td><pre>    geom_point<span class="token punctuation">(</span>alpha <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="138"></td><td><pre>    guides<span class="token punctuation">(</span>color <span class="token operator">=</span> guide_legend<span class="token punctuation">(</span>override.aes <span class="token operator">=</span> list<span class="token punctuation">(</span>size <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="139"></td><td><pre>    scale_color_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> colors<span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    labs<span class="token punctuation">(</span>title <span class="token operator">=</span> title<span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token string">"log2(FoldChange)"</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">"-log10(Pvalue)"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="141"></td><td><pre>    geom_vline<span class="token punctuation">(</span>xintercept <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="142"></td><td><pre>    geom_hline<span class="token punctuation">(</span>yintercept <span class="token operator">=</span> <span class="token operator">-</span>log10<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="143"></td><td><pre>    mytheme</pre></td></tr><tr><td data-num="144"></td><td><pre>  </pre></td></tr><tr><td data-num="145"></td><td><pre>  <span class="token comment"># 如果有标签，添加标签</span></pre></td></tr><tr><td data-num="146"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is.null<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="147"></td><td><pre>    p <span class="token operator">&lt;-</span> p <span class="token operator">+</span> geom_text_repel<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span> ifelse<span class="token punctuation">(</span>Label <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> rownames<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="148"></td><td><pre>                             arrow <span class="token operator">=</span> arrow<span class="token punctuation">(</span>ends<span class="token operator">=</span><span class="token string">"first"</span><span class="token punctuation">,</span> length <span class="token operator">=</span> unit<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token string">"npc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> show.legend <span class="token operator">=</span> F<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="149"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="150"></td><td><pre>  </pre></td></tr><tr><td data-num="151"></td><td><pre>  return<span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="152"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><h3 id="结果解读"><a class="anchor" href="#结果解读">#</a> 结果解读</h3>
<p>通常经过差异表达分析我们会获得如下结果：</p>
<figure class="highlight r"><figcaption data-lang="r"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token operator">&gt;</span> head<span class="token punctuation">(</span>degs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>           logFC    AveExpr         t      P.Value    adj.P.Val        B Regulation</pre></td></tr><tr><td data-num="3"></td><td><pre>MESDC2 <span class="token operator">-</span><span class="token number">5.406474</span>  <span class="token number">5.2581480</span> <span class="token operator">-</span><span class="token number">9.940661</span> <span class="token number">3.711317e-19</span> <span class="token number">7.509108e-15</span> <span class="token number">32.68792</span>       Down</pre></td></tr><tr><td data-num="4"></td><td><pre>CLVS1  <span class="token operator">-</span><span class="token number">3.035352</span>  <span class="token number">8.3649303</span> <span class="token operator">-</span><span class="token number">9.702325</span> <span class="token number">1.823051e-18</span> <span class="token number">1.844289e-14</span> <span class="token number">31.15791</span>       Down</pre></td></tr><tr><td data-num="5"></td><td><pre>MTBP   <span class="token operator">-</span><span class="token number">2.883240</span>  <span class="token number">9.0324125</span> <span class="token operator">-</span><span class="token number">9.492411</span> <span class="token number">7.326974e-18</span> <span class="token number">4.941556e-14</span> <span class="token number">29.82074</span>       Down</pre></td></tr><tr><td data-num="6"></td><td><pre>GUCA2A  <span class="token number">2.694356</span> <span class="token operator">-</span><span class="token number">0.1384359</span>  <span class="token number">9.348538</span> <span class="token number">1.889189e-17</span> <span class="token number">9.555991e-14</span> <span class="token number">28.91025</span>         Up</pre></td></tr><tr><td data-num="7"></td><td><pre>GUCA2B  <span class="token number">2.743741</span> <span class="token operator">-</span><span class="token number">0.2315600</span>  <span class="token number">9.287302</span> <span class="token number">2.822673e-17</span> <span class="token number">1.142223e-13</span> <span class="token number">28.52427</span>         Up</pre></td></tr><tr><td data-num="8"></td><td><pre>METTL5 <span class="token operator">-</span><span class="token number">2.568758</span>  <span class="token number">9.4407518</span> <span class="token operator">-</span><span class="token number">9.206254</span> <span class="token number">4.795137e-17</span> <span class="token number">1.617000e-13</span> <span class="token number">28.01489</span>       Down</pre></td></tr></tbody></table></figure><p>我们来逐列解释这些结果：</p>
<ol>
<li><strong>logFC</strong>（对数折叠变化，Log Fold Change）：
<ul>
<li>logFC 表示目标基因在不同条件（如实验组和对照组）之间表达水平的对数变化值，通常以 2 为底数。其负值表示在实验组中下调，正值表示上调。</li>
<li>例如，如果我们做了一个肿瘤组织（T）与癌旁组织（N）的差异表达分析（T-N）：如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>F</mi><mi>C</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">logFC&gt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>F</mi><mi>C</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">log_2FC&gt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>C</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">FC&gt;1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，也就是说 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>T</mi><mtext>的表达水平</mtext></mrow><mrow><mi>N</mi><mtext>的表达水平</mtext></mrow></mfrac><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\frac{T 的表达水平}{N 的表达水平}&gt;1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord cjk_fallback mtight">的表达水平</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord cjk_fallback mtight">的表达水平</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，所以 T 组上调。</li>
</ul>
</li>
<li><strong>AveExpr</strong>（平均表达值，Average Expression）：
<ul>
<li>这是基因在所有样本中的平均表达水平。</li>
<li>例如，MESDC2 的  <code>AveExpr</code>  为 5.2581480，表示其在所有样本中的平均表达值为 5.2581480。</li>
</ul>
</li>
<li><strong>t</strong>（t 统计量，T-statistic）：
<ul>
<li>这是用于检验基因表达差异显著性的 t 检验统计量。</li>
<li>例如，MESDC2 的  <code>t 值</code>  为 -9.940661，表示其在对照组和实验组之间的表达差异非常显著。</li>
</ul>
</li>
<li><strong>P.Value</strong>（P 值，P-Value）：
<ul>
<li>这是 t 检验的原始 P 值，表示基因表达差异的显著性水平。较小的 P 值表示差异更显著。</li>
<li>例如，MESDC2 的  <code>P 值</code>  为 3.711317e-19，表示其表达差异极其显著。</li>
</ul>
</li>
<li><strong>adj.P.Val</strong>（调整后的 P 值，Adjusted P-Value）：
<ul>
<li>这是经过多重检验校正后的 P 值（例如，使用 Benjamini-Hochberg 方法）。调整后的 P 值用于控制假阳性率。</li>
<li>例如，MESDC2 的  <code>调整后的 P 值</code>  为 7.509108e-15，仍然表示其表达差异非常显著。</li>
</ul>
</li>
<li><strong>B</strong>（B 统计量，B-Statistic）：
<ul>
<li>这是基于贝叶斯统计方法计算的 B 值，用于估计基因为差异表达基因的概率。较高的 B 值表示更高的可信度。</li>
<li>例如，MESDC2 的  <code>B 值</code>  为 32.68792，表示其差异表达的可信度非常高。</li>
</ul>
</li>
<li><strong>Regulation</strong>（调控方向，Regulation）：
<ul>
<li>这是根据 logFC 的符号确定的调控方向，“Up” 表示上调，“Down” 表示下调。</li>
<li>例如，MESDC2 的调控方向为 “Down”，表示其在实验组中表达下调。</li>
</ul>
</li>
</ol>
<p>通过上述结果，我们可以看到几个基因在对照组和实验组之间的表达差异显著。例如，MESDC2 的表达在实验组中显著下调，而 GUCA2A 的表达在实验组中显著上调。调整后的 P 值和 B 统计量进一步验证了这些差异的显著性和可信度。</p>
<div class="tags"><a href="/tags/R/" rel="tag"><i class="ic i-tag"></i>R</a><a href="/tags/%E7%94%9F%E4%BF%A1/" rel="tag"><i class="ic i-tag"></i>生信</a><a href="/tags/RNA-Seq/" rel="tag"><i class="ic i-tag"></i>RNA-Seq</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-06-05 10:00:44" itemprop="dateModified" datetime="2024-06-05T10:00:44+08:00">2024-06-05</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.webp" alt="WhyLIM 微信支付"><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.webp" alt="WhyLIM 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>WhyLIM<i class="ic i-at"><em>@</em></i>Being on sea, sail; being on land, settle.</li><li class="link"><strong>本文链接：</strong><a href="https://new.limina.top/2024/05/29/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/" title="差异表达分析：使用 R 进行 RNA-Seq 数据分析">https://new.limina.top/2024/05/29/差异表达分析/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/05/27/shokax%E9%85%8D%E7%BD%AE/" rel="prev" itemprop="url" data-background-image="https://img.limina.top/blog/image-20240522155439876.png" title="Hexo + ShokaX 博客搭建"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>博客</span><h3>Hexo + ShokaX 博客搭建</h3></a></div><div class="item right"><a href="/2024/05/29/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%B8%B8%E8%A7%81%E7%BB%9F%E8%AE%A1%E9%87%8F/" rel="next" itemprop="url" data-background-image="https://img.limina.top/blog/statistics.png" title="生物信息学中的常见统计量"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>统计学</span><h3>生物信息学中的常见统计量</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90%E4%BD%BF%E7%94%A8-r-%E8%BF%9B%E8%A1%8C-rna-seq-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text"> 差异表达分析：使用 R 进行 RNA-Seq 数据分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text"> 差异表达分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">1.2.</span> <span class="toc-text"> 使用的软件包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.</span> <span class="toc-text"> 函数实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87%E5%92%8C%E8%BE%93%E5%85%A5"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 数据准备和输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E4%BF%A1%E6%81%AF%E5%92%8C%E8%AE%BE%E8%AE%A1%E7%9F%A9%E9%98%B5"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 分组信息和设计矩阵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rna-seq-%E6%95%B0%E6%8D%AE%E5%BD%92%E4%B8%80%E5%8C%96"><span class="toc-number">1.3.3.</span> <span class="toc-text"> RNA-Seq 数据归一化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B%E5%92%8C%E7%BB%8F%E9%AA%8C%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.3.4.</span> <span class="toc-text"> 线性模型和经验贝叶斯分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%AF%B9%E6%AF%94%E7%9F%A9%E9%98%B5"><span class="toc-number">1.3.5.</span> <span class="toc-text"> 生成对比矩阵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%AF%B9%E6%AF%94%E7%9F%A9%E9%98%B5%E5%B9%B6%E7%94%9F%E6%88%90%E8%AF%A6%E7%BB%86%E7%BB%93%E6%9E%9C"><span class="toc-number">1.3.6.</span> <span class="toc-text"> 应用对比矩阵并生成详细结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E7%BB%93%E6%9E%9C"><span class="toc-number">1.3.7.</span> <span class="toc-text"> 提取结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%81%AB%E5%B1%B1%E5%9B%BE"><span class="toc-number">1.3.8.</span> <span class="toc-text"> 绘制火山图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.9.</span> <span class="toc-text"> 完整代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E8%A7%A3%E8%AF%BB"><span class="toc-number">1.3.10.</span> <span class="toc-text"> 结果解读</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2024/05/29/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/" rel="bookmark" title="差异表达分析：使用 R 进行 RNA-Seq 数据分析">差异表达分析：使用 R 进行 RNA-Seq 数据分析</a></li><li><a href="/2024/06/12/%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%AF%8C%E9%9B%86%E5%88%86%E6%9E%90%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="bookmark" title="不一样的富集分析可视化">不一样的富集分析可视化</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="WhyLIM" src="/assets/avatar.webp"><p class="name" itemprop="name">WhyLIM</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">43</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">45</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">39</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/WhyLIM" class="item github" title="https://github.com/WhyLIM"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://scholar.google.com/citations?hl=zh-CN&amp;user=BXyoIosAAAAJ" class="item gscholar" title="https://scholar.google.com/citations?hl=zh-CN&amp;user=BXyoIosAAAAJ"><i class="ic i-gscholar"></i></a><a target="_blank" rel="noopener" href="https://www.researchgate.net/profile/Min-Li-331" class="item researchgate" title="https://www.researchgate.net/profile/Min-Li-331"><i class="ic i-researchgate"></i></a><a href="mailto:mli.bio@ouutlook.com" class="item email" title="mailto:mli.bio@ouutlook.com"><i class="ic i-envelope"></i></a><a target="_blank" rel="noopener" href="https://cv.limina.top/" class="item about" title="https://cv.limina.top/"><i class="ic i-icon_CV"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/05/29/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%B8%B8%E8%A7%81%E7%BB%9F%E8%AE%A1%E9%87%8F/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/05/27/shokax%E9%85%8D%E7%BD%AE/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">© 2021 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">WhyLIM @ WhyLIM</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">214k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">3:14</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> &amp; Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div><br><span style="display:inline;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:var(--grey-5);"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">苏 ICP 备 2021008103 号</a><br><a target="_blank" href="https://beian.mps.gov.cn/#/query/webSearch?code=32062302000380"><img loading="lazy" decoding="async" data-src="/assets/备案图标.webp" style="max-width: 2em;display:inline;" width="20" height="20" alt="备案">苏公网安备 32062302000380</a></span></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/05/29/差异表达分析/`,
        favicon: {
        show: `骗骗你的:)`,
        hide: `页面崩溃啦`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: true,
    katex: true,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js" async=""></script><script src="/js/siteInit.js?v=0.4.2" type="module" fetchpriority="high" defer=""></script></body></html>