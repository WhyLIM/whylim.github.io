{
    "version": "https://jsonfeed.org/version/1",
    "title": "Being on sea, sail; being on land, settle. • All posts by \"scrna-seq\" tag",
    "description": "",
    "home_page_url": "https://new.limina.top",
    "items": [
        {
            "id": "https://new.limina.top/2024/09/18/%E9%93%B6%E5%B1%91%E7%97%85%E5%8D%95%E7%BB%86%E8%83%9E%E6%95%B0%E6%8D%AE%20GSE151177%20%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/",
            "url": "https://new.limina.top/2024/09/18/%E9%93%B6%E5%B1%91%E7%97%85%E5%8D%95%E7%BB%86%E8%83%9E%E6%95%B0%E6%8D%AE%20GSE151177%20%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/",
            "title": "银屑病单细胞数据 GSE151177 分析复现",
            "date_published": "2024-09-18T01:29:41.000Z",
            "content_html": "<h1 id=\"银屑病单细胞数据-gse151177-分析复现\"><a class=\"anchor\" href=\"#银屑病单细胞数据-gse151177-分析复现\">#</a> 银屑病单细胞数据 GSE151177 分析复现</h1>\n<blockquote>\n<p>文章标题为 <em><strong>Single-cell transcriptomics applied to emigrating cells from psoriasis elucidate pathogenic versus regulatory immune cell subsets（单细胞转录组学应用于银屑病迁移细胞阐明致病性与调节性免疫细胞亚群）</strong></em>，发表在 <em>Journal of Allergy And Clinical Immunology</em> 上，IF14.2（2024）</p>\n<p>数据为 <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE151177\">GSE151177</a>，文章提供了<a href=\"https://github.com/jaehwan79/KruegerLab_scRNAseq_emigrating_cells_human_skin\">分析代码</a>，但由于是 2021 年的文章，使用的是 Seurat V3，且代码冗余很多，因此我们使用 Seurat V5 进行复现。步骤和方法尽量保持和原文一致。</p>\n</blockquote>\n<h2 id=\"目录组织和数据下载\"><a class=\"anchor\" href=\"#目录组织和数据下载\">#</a> 目录组织和数据下载</h2>\n<p>依据我的习惯，在项目目录  <code>scPsoriasis</code>  下新建如下目录，并将数据下载到  <code>data/GSE151177/</code></p>\n<p>目录结构</p>\n<pre><code>scPsoriasis/\n├─data/\n│  └─GSE151177/\n├─results/\n│  └─GSE151177/\n└─scripts/\n   └─GSE151177/\n</code></pre>\n<p>解压后发现是 69 个  <code>.gz</code>  文件（23 个样本 * 3），文件名格式形如  <code>GSM4567877_Control01_barcodes.tsv.gz</code></p>\n<p>此外，在其 Github 仓库中还提供了一个表型文件  <code>phenotype_data.txt</code></p>\n<h2 id=\"数据预处理\"><a class=\"anchor\" href=\"#数据预处理\">#</a> 数据预处理</h2>\n<p>首先加载包，定义数据、结果和脚本路径，并将路径设置到结果</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>library<span class=\"token punctuation\">(</span>Seurat<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>library<span class=\"token punctuation\">(</span>tidyverse<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>rm<span class=\"token punctuation\">(</span>list <span class=\"token operator\">=</span> ls<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>datadir <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"D:/Study/Project/GDG/scPsoriasis/data/GSE151177/\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>resultdir <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"D:/Study/Project/GDG/scPsoriasis/results/GSE151177/\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>scriptdir <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"D:/Study/Project/GDG/scPsoriasis/scripts/GSE151177/\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>setwd<span class=\"token punctuation\">(</span>resultdir<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"文件整理\"><a class=\"anchor\" href=\"#文件整理\">#</a> 文件整理</h3>\n<p>该数据集是标准的 10X 测序输出文件，但我们仍需要先稍做处理</p>\n<p>自定义  <code>organize_files</code>  函数，将文件按前缀分文件夹并去除多余的前缀：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 将文件按照前缀移动到相应的子文件夹，并去除前缀的函数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>organize_files <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\"># 设置工作目录为目标目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  setwd<span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\"># 获取当前目录下所有文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  files <span class=\"token operator\">&lt;-</span> list.files<span class=\"token punctuation\">(</span>pattern <span class=\"token operator\">=</span> <span class=\"token string\">\"*.gz\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\"># 遍历文件</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>file <span class=\"token keyword\">in</span> files<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\"># 提取前缀（如 GSM4567877_Control01）</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    prefix <span class=\"token operator\">&lt;-</span> sub<span class=\"token punctuation\">(</span><span class=\"token string\">\"_(barcodes|features|matrix).*\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\"># 创建文件夹，检查文件夹是否存在，如果不存在则创建</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>dir.exists<span class=\"token punctuation\">(</span>prefix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      dir.create<span class=\"token punctuation\">(</span>prefix<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\"># 去掉前缀</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    new_file <span class=\"token operator\">&lt;-</span> sub<span class=\"token punctuation\">(</span><span class=\"token string\">\"^.*?(barcodes|features|matrix).*\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\1\"</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\"># 将文件移动到相应的文件夹并重命名</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    file.rename<span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> file.path<span class=\"token punctuation\">(</span>prefix<span class=\"token punctuation\">,</span> new_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\"># 返回处理完成后的文件夹名称</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  return<span class=\"token punctuation\">(</span>list.dirs<span class=\"token punctuation\">(</span>path <span class=\"token operator\">=</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> full.names <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> recursive <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>sample_dirs <span class=\"token operator\">&lt;-</span> organize_files<span class=\"token punctuation\">(</span>file.path<span class=\"token punctuation\">(</span>datadir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSE151177_RAW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>该函数会自动识别  <code>.gz</code>  文件并根据样本前缀创建相应的文件夹</p>\n<p>执行完成后的  <code>data</code>  目录应如下：</p>\n<pre><code>data/\n└─GSE151177/\n    └─GSE151177_RAW/\n        ├─GSM4567877_Control01/\n        ├─GSM4567878_Control02/\n        ├─GSM4567879_Control03/\n        ├─GSM4567880_Control04/\n        ├─GSM4567881_Control05/\n        ├─GSM4567882_Control05F/\n        ├─GSM4567883_Psoriasis01/\n        ├─GSM4567884_Psoriasis02/\n        ├─GSM4567885_Psoriasis02F/\n        ├─GSM4567886_Psoriasis03/\n        ├─GSM4567887_Psoriasis03F/\n        ├─GSM4567888_Psoriasis04/\n        ├─GSM4567889_Psoriasis04F/\n        ├─GSM4567890_Psoriasis05/\n        ├─GSM4567891_Psoriasis06/\n        ├─GSM4567892_Psoriasis06F/\n        ├─GSM4567893_Psoriasis07/\n        ├─GSM4567894_Psoriasis08/\n        ├─GSM4567895_Psoriasis09/\n        ├─GSM4567896_Psoriasis10/\n        ├─GSM4567897_Psoriasis11/\n        ├─GSM4567898_Psoriasis12/\n        └─GSM4567899_Psoriasis13/\n</code></pre>\n<p>每一个文件夹下都是三个文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre> <span class=\"token function\">ls</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    目录: D:<span class=\"token punctuation\">\\</span>Study<span class=\"token punctuation\">\\</span>Project<span class=\"token punctuation\">\\</span>GDG<span class=\"token punctuation\">\\</span>scPsoriasis<span class=\"token punctuation\">\\</span>data<span class=\"token punctuation\">\\</span>GSE151177<span class=\"token punctuation\">\\</span>GSE151177_RAW<span class=\"token punctuation\">\\</span>GSM4567877_Control01</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Mode                 LastWriteTime         Length Name</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>----                 -------------         ------ ----</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">13776</span> barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> features.tsv.gz</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">16419935</span> matrix.mtx.gz</pre></td></tr></table></figure><h3 id=\"样本分组\"><a class=\"anchor\" href=\"#样本分组\">#</a> 样本分组</h3>\n<p>接下来，我们读取  <code>phenotype_data.txt</code>  文件，以获取样本的表型信息，帮助我们区分银屑病和对照样本：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>phenotype <span class=\"token operator\">&lt;-</span> read.delim<span class=\"token punctuation\">(</span><span class=\"token string\">\"../phenotype_data.txt\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>根据表型信息，我们将样本分为三组：</p>\n<ul>\n<li>银屑病（Psoriasis）_试剂盒版本 2.0</li>\n<li>银屑病（Psoriasis）_试剂盒版本 3.0</li>\n<li>对照（Control）_试剂盒版本 2.0</li>\n</ul>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>psoriasis_v2_samples <span class=\"token operator\">&lt;-</span> phenotype<span class=\"token operator\">$</span>ID<span class=\"token punctuation\">[</span>phenotype<span class=\"token operator\">$</span>Category <span class=\"token operator\">==</span> <span class=\"token string\">\"Psoriasis\"</span> <span class=\"token operator\">&amp;</span> phenotype<span class=\"token operator\">$</span>Chemistry <span class=\"token operator\">==</span> <span class=\"token string\">\"V2.0\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>psoriasis_v3_samples <span class=\"token operator\">&lt;-</span> phenotype<span class=\"token operator\">$</span>ID<span class=\"token punctuation\">[</span>phenotype<span class=\"token operator\">$</span>Category <span class=\"token operator\">==</span> <span class=\"token string\">\"Psoriasis\"</span> <span class=\"token operator\">&amp;</span> phenotype<span class=\"token operator\">$</span>Chemistry <span class=\"token operator\">==</span> <span class=\"token string\">\"V3.0\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>control_v2_samples <span class=\"token operator\">&lt;-</span> phenotype<span class=\"token operator\">$</span>ID<span class=\"token punctuation\">[</span>phenotype<span class=\"token operator\">$</span>Category <span class=\"token operator\">==</span> <span class=\"token string\">\"Control\"</span> <span class=\"token operator\">&amp;</span> phenotype<span class=\"token operator\">$</span>Chemistry <span class=\"token operator\">==</span> <span class=\"token string\">\"V2.0\"</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h3 id=\"匹配文件夹\"><a class=\"anchor\" href=\"#匹配文件夹\">#</a> 匹配文件夹</h3>\n<p>接下来，我们匹配样本目录，以便后续读取数据</p>\n<p>自定义  <code>get_phenotype_from_dir</code>  和  <code>match_sample_dirs</code>  函数以根据 phenotype 的样本 ID 匹配对应的文件夹</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 从 sample_dirs 中提取 phenotype 部分的函数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>get_phenotype_from_dir <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\"># 文件夹名的格式是 GSMxxx_phenotype，使用 strsplit 按照 \"_\" 分割</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  phenotype_part <span class=\"token operator\">&lt;-</span> strsplit<span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"_\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  return<span class=\"token punctuation\">(</span>phenotype_part<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 根据 phenotype 的样本 ID 匹配对应的文件夹名的函数</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>match_sample_dirs <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>samples<span class=\"token punctuation\">,</span> sample_dirs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token comment\"># 提取所有文件夹名中的 phenotype 部分</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  phenotype_dirs <span class=\"token operator\">&lt;-</span> sapply<span class=\"token punctuation\">(</span>sample_dirs<span class=\"token punctuation\">,</span> get_phenotype_from_dir<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token comment\"># 根据样本 ID 与 phenotype 部分进行精确匹配</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  matched_dirs <span class=\"token operator\">&lt;-</span> sample_dirs<span class=\"token punctuation\">[</span>phenotype_dirs <span class=\"token percent-operator operator\">%in%</span> samples<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  return<span class=\"token punctuation\">(</span>matched_dirs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>匹配对应的文件夹</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 根据 phenotype 的信息动态构建分组</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>psoriasis_v2_samples <span class=\"token operator\">&lt;-</span> phenotype<span class=\"token operator\">$</span>ID<span class=\"token punctuation\">[</span>phenotype<span class=\"token operator\">$</span>Category <span class=\"token operator\">==</span> <span class=\"token string\">\"Psoriasis\"</span> <span class=\"token operator\">&amp;</span> phenotype<span class=\"token operator\">$</span>Chemistry <span class=\"token operator\">==</span> <span class=\"token string\">\"V2.0\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>psoriasis_v3_samples <span class=\"token operator\">&lt;-</span> phenotype<span class=\"token operator\">$</span>ID<span class=\"token punctuation\">[</span>phenotype<span class=\"token operator\">$</span>Category <span class=\"token operator\">==</span> <span class=\"token string\">\"Psoriasis\"</span> <span class=\"token operator\">&amp;</span> phenotype<span class=\"token operator\">$</span>Chemistry <span class=\"token operator\">==</span> <span class=\"token string\">\"V3.0\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>control_v2_samples <span class=\"token operator\">&lt;-</span> phenotype<span class=\"token operator\">$</span>ID<span class=\"token punctuation\">[</span>phenotype<span class=\"token operator\">$</span>Category <span class=\"token operator\">==</span> <span class=\"token string\">\"Control\"</span> <span class=\"token operator\">&amp;</span> phenotype<span class=\"token operator\">$</span>Chemistry <span class=\"token operator\">==</span> <span class=\"token string\">\"V2.0\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 匹配对应的文件夹名</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>psoriasis_v2_dirs <span class=\"token operator\">&lt;-</span> match_sample_dirs<span class=\"token punctuation\">(</span>psoriasis_v2_samples<span class=\"token punctuation\">,</span> sample_dirs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>psoriasis_v3_dirs <span class=\"token operator\">&lt;-</span> match_sample_dirs<span class=\"token punctuation\">(</span>psoriasis_v3_samples<span class=\"token punctuation\">,</span> sample_dirs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>control_v2_dirs <span class=\"token operator\">&lt;-</span> match_sample_dirs<span class=\"token punctuation\">(</span>control_v2_samples<span class=\"token punctuation\">,</span> sample_dirs<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>命名文件夹向量，使合并后数据的  <code>orig.ident</code>  易识别</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 命名文件夹向量</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>names<span class=\"token punctuation\">(</span>psoriasis_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> psoriasis_v2_samples</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>names<span class=\"token punctuation\">(</span>psoriasis_v3_dirs<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> psoriasis_v3_samples</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>names<span class=\"token punctuation\">(</span>control_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> control_v2_samples</pre></td></tr></table></figure><h3 id=\"读取数据并创建-seurat-对象\"><a class=\"anchor\" href=\"#读取数据并创建-seurat-对象\">#</a> 读取数据并创建 Seurat 对象</h3>\n<p>使用  <code>Read10X</code>  函数读取数据，并创建 Seurat 对象：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Psoriasis_V2.<span class=\"token number\">0</span> <span class=\"token operator\">&lt;-</span> Read10X<span class=\"token punctuation\">(</span>psoriasis_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> .<span class=\"token punctuation\">,</span> min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Psoriasis_V3.<span class=\"token number\">0</span> <span class=\"token operator\">&lt;-</span> Read10X<span class=\"token punctuation\">(</span>psoriasis_v3_dirs<span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> .<span class=\"token punctuation\">,</span> min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Control_V2.<span class=\"token number\">0</span> <span class=\"token operator\">&lt;-</span> Read10X<span class=\"token punctuation\">(</span>control_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> .<span class=\"token punctuation\">,</span> min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"数据标准化\"><a class=\"anchor\" href=\"#数据标准化\">#</a> 数据标准化</h3>\n<p>在合并样本之前，需要对每个 Seurat 对象进行标准化：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Psoriasis_V2.<span class=\"token number\">0</span> <span class=\"token operator\">&lt;-</span> NormalizeData<span class=\"token punctuation\">(</span>Psoriasis_V2.<span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> FindVariableFeatures<span class=\"token punctuation\">(</span>selection.method <span class=\"token operator\">=</span> <span class=\"token string\">\"vst\"</span><span class=\"token punctuation\">,</span> nfeatures <span class=\"token operator\">=</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Psoriasis_V3.<span class=\"token number\">0</span> <span class=\"token operator\">&lt;-</span> NormalizeData<span class=\"token punctuation\">(</span>Psoriasis_V3.<span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> FindVariableFeatures<span class=\"token punctuation\">(</span>selection.method <span class=\"token operator\">=</span> <span class=\"token string\">\"vst\"</span><span class=\"token punctuation\">,</span> nfeatures <span class=\"token operator\">=</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Control_V2.<span class=\"token number\">0</span> <span class=\"token operator\">&lt;-</span> NormalizeData<span class=\"token punctuation\">(</span>Control_V2.<span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> FindVariableFeatures<span class=\"token punctuation\">(</span>selection.method <span class=\"token operator\">=</span> <span class=\"token string\">\"vst\"</span><span class=\"token punctuation\">,</span> nfeatures <span class=\"token operator\">=</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"数据整合\"><a class=\"anchor\" href=\"#数据整合\">#</a> 数据整合</h3>\n<p>为了消除批次效应，使用  <code>FindIntegrationAnchors()</code>  函数识别不同数据集中的细胞锚点，然后通过  <code>IntegrateData()</code>  函数整合数据：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>immune.anchors <span class=\"token operator\">&lt;-</span> FindIntegrationAnchors<span class=\"token punctuation\">(</span>object.list <span class=\"token operator\">=</span> list<span class=\"token punctuation\">(</span>Psoriasis_V2.<span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Psoriasis_V3.<span class=\"token number\">0</span><span class=\"token punctuation\">,</span> Control_V2.<span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dims <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Round0 <span class=\"token operator\">&lt;-</span> IntegrateData<span class=\"token punctuation\">(</span>anchorset <span class=\"token operator\">=</span> immune.anchors<span class=\"token punctuation\">,</span> dims <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"保存整合数据\"><a class=\"anchor\" href=\"#保存整合数据\">#</a> 保存整合数据</h3>\n<p>最后，我们将整合后的数据保存为 Rda 文件，便于后续分析：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>save<span class=\"token punctuation\">(</span>Round0<span class=\"token punctuation\">,</span> file <span class=\"token operator\">=</span> <span class=\"token string\">\"Round0_integrated.Rda\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "scRNA-seq",
                "Seurat"
            ]
        },
        {
            "id": "https://new.limina.top/2024/07/11/%E5%9F%BA%E4%BA%8E%20Seurat%20V5%20%E7%9A%84%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/",
            "url": "https://new.limina.top/2024/07/11/%E5%9F%BA%E4%BA%8E%20Seurat%20V5%20%E7%9A%84%E5%8D%95%E7%BB%86%E8%83%9E%E6%B5%8B%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/",
            "title": "基于 Seurat V5 的单细胞测序数据分析的注意点与技巧",
            "date_published": "2024-07-11T06:25:06.000Z",
            "content_html": "<h1 id=\"基于-seurat-v5-的单细胞测序数据分析的注意点与技巧\"><a class=\"anchor\" href=\"#基于-seurat-v5-的单细胞测序数据分析的注意点与技巧\">#</a> 基于 Seurat V5 的单细胞测序数据分析的注意点与技巧</h1>\n<h2 id=\"数据读取\"><a class=\"anchor\" href=\"#数据读取\">#</a> 数据读取</h2>\n<h3 id=\"如何读取多个样本\"><a class=\"anchor\" href=\"#如何读取多个样本\">#</a> 如何读取多个样本</h3>\n<p>以 GSE151177（10X 样本数据）读取为例</p>\n<p>通常我们下载的数据解压后可能都在同一个文件夹中</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre> <span class=\"token function\">ls</span>                                                                                                                                                                                                                                  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    目录: D:<span class=\"token punctuation\">\\</span>Study<span class=\"token punctuation\">\\</span>Project<span class=\"token punctuation\">\\</span>GDG<span class=\"token punctuation\">\\</span>scPsoriasis<span class=\"token punctuation\">\\</span>data<span class=\"token punctuation\">\\</span>GSE151177<span class=\"token punctuation\">\\</span>GSE151177_RAW</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Mode                 LastWriteTime         Length Name</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>----                 -------------         ------ ----</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">13776</span> GSM4567877_Control01_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567877_Control01_features.tsv.gz</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">16419935</span> GSM4567877_Control01_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">5829</span> GSM4567878_Control02_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567878_Control02_features.tsv.gz</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">3573641</span> GSM4567878_Control02_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">2155</span> GSM4567879_Control03_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567879_Control03_features.tsv.gz</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">1441746</span> GSM4567879_Control03_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">8430</span> GSM4567880_Control04_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567880_Control04_features.tsv.gz</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">6875043</span> GSM4567880_Control04_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">1669</span> GSM4567881_Control05_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567881_Control05_features.tsv.gz</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">489487</span> GSM4567881_Control05_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>-a----         <span class=\"token number\">6</span>/14/2020   <span class=\"token number\">1</span>:30 AM           <span class=\"token number\">1494</span> GSM4567882_Control05F_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>-a----         <span class=\"token number\">6</span>/14/2020   <span class=\"token number\">1</span>:30 AM         <span class=\"token number\">304728</span> GSM4567882_Control05F_features.tsv.gz</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>-a----         <span class=\"token number\">6</span>/14/2020   <span class=\"token number\">1</span>:30 AM         <span class=\"token number\">147394</span> GSM4567882_Control05F_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>-a----         <span class=\"token number\">6</span>/14/2020   <span class=\"token number\">1</span>:53 AM           <span class=\"token number\">3889</span> GSM4567883_Psoriasis01_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>-a----         <span class=\"token number\">6</span>/14/2020   <span class=\"token number\">1</span>:53 AM         <span class=\"token number\">304728</span> GSM4567883_Psoriasis01_features.tsv.gz</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>-a----         <span class=\"token number\">6</span>/14/2020   <span class=\"token number\">1</span>:53 AM        <span class=\"token number\">3289901</span> GSM4567883_Psoriasis01_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">3970</span> GSM4567884_Psoriasis02_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567884_Psoriasis02_features.tsv.gz</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">3318396</span> GSM4567884_Psoriasis02_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">3599</span> GSM4567885_Psoriasis02F_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567885_Psoriasis02F_features.tsv.gz</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">1848116</span> GSM4567885_Psoriasis02F_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">6924</span> GSM4567886_Psoriasis03_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567886_Psoriasis03_features.tsv.gz</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">7062387</span> GSM4567886_Psoriasis03_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>-a----         <span class=\"token number\">5</span>/26/2020  <span class=\"token number\">11</span>:44 AM           <span class=\"token number\">3037</span> GSM4567887_Psoriasis03F_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>-a----         <span class=\"token number\">5</span>/26/2020  <span class=\"token number\">11</span>:44 AM         <span class=\"token number\">304728</span> GSM4567887_Psoriasis03F_features.tsv.gz</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>-a----         <span class=\"token number\">5</span>/26/2020  <span class=\"token number\">11</span>:44 AM         <span class=\"token number\">975940</span> GSM4567887_Psoriasis03F_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">5366</span> GSM4567888_Psoriasis04_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567888_Psoriasis04_features.tsv.gz</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">5613417</span> GSM4567888_Psoriasis04_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">7450</span> GSM4567889_Psoriasis04F_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567889_Psoriasis04F_features.tsv.gz</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">3059527</span> GSM4567889_Psoriasis04F_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">5525</span> GSM4567890_Psoriasis05_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567890_Psoriasis05_features.tsv.gz</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">5228209</span> GSM4567890_Psoriasis05_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">7983</span> GSM4567891_Psoriasis06_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567891_Psoriasis06_features.tsv.gz</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">7441699</span> GSM4567891_Psoriasis06_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">4842</span> GSM4567892_Psoriasis06F_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567892_Psoriasis06F_features.tsv.gz</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">5298708</span> GSM4567892_Psoriasis06F_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">4452</span> GSM4567893_Psoriasis07_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567893_Psoriasis07_features.tsv.gz</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">4163977</span> GSM4567893_Psoriasis07_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">11775</span> GSM4567894_Psoriasis08_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567894_Psoriasis08_features.tsv.gz</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">11177661</span> GSM4567894_Psoriasis08_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">15318</span> GSM4567895_Psoriasis09_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567895_Psoriasis09_features.tsv.gz</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">15250717</span> GSM4567895_Psoriasis09_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">10836</span> GSM4567896_Psoriasis10_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567896_Psoriasis10_features.tsv.gz</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">11705956</span> GSM4567896_Psoriasis10_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM           <span class=\"token number\">9814</span> GSM4567897_Psoriasis11_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567897_Psoriasis11_features.tsv.gz</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">10868239</span> GSM4567897_Psoriasis11_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">23278</span> GSM4567898_Psoriasis12_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567898_Psoriasis12_features.tsv.gz</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM       <span class=\"token number\">24708520</span> GSM4567898_Psoriasis12_matrix.mtx.gz</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM          <span class=\"token number\">12039</span> GSM4567899_Psoriasis13_barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM         <span class=\"token number\">304728</span> GSM4567899_Psoriasis13_features.tsv.gz</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>-a----         <span class=\"token number\">5</span>/24/2020  <span class=\"token number\">10</span>:59 AM        <span class=\"token number\">9919157</span> GSM4567899_Psoriasis13_matrix.mtx.gz</pre></td></tr></table></figure><p>可以看到，前缀相同的是同一个样本，对于每个样本，10X 标准输出 3 个文件： <code>barcodes.tsv</code> ,  <code>features.tsv</code> ,  <code>matrix.mtx</code> 。这是最标准的情况，barcodes.tsv 就是 cell id，features.tsv 就是 gene id，matrix.mtx 就是计数 counts 矩阵</p>\n<p>根据 Seurat 包的  <code>Read10X()</code>  函数要求，我们需要整理一下文件，为每个样本单独建立一个文件夹，然后将样本对应的 3 个文件重命名一下</p>\n<p>在 R 语言中，可以写一个函数来完成这些操作：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 将文件按照前缀移动到相应的子文件夹，并去除前缀的函数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>organize_files <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\"># 设置工作目录为目标目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  setwd<span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\"># 获取当前目录下所有文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  files <span class=\"token operator\">&lt;-</span> list.files<span class=\"token punctuation\">(</span>pattern <span class=\"token operator\">=</span> <span class=\"token string\">\"*.gz\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\"># 遍历文件</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>file <span class=\"token keyword\">in</span> files<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\"># 提取前缀（如 GSM4567877_Control01）</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    prefix <span class=\"token operator\">&lt;-</span> sub<span class=\"token punctuation\">(</span><span class=\"token string\">\"_(barcodes|features|matrix).*\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\"># 创建文件夹，检查文件夹是否存在，如果不存在则创建</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>dir.exists<span class=\"token punctuation\">(</span>prefix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      dir.create<span class=\"token punctuation\">(</span>prefix<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\"># 去掉前缀</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    new_file <span class=\"token operator\">&lt;-</span> sub<span class=\"token punctuation\">(</span><span class=\"token string\">\"^.*?(barcodes|features|matrix).*\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\1\"</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\"># 将文件移动到相应的文件夹并重命名</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    file.rename<span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> file.path<span class=\"token punctuation\">(</span>prefix<span class=\"token punctuation\">,</span> new_file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\"># 返回处理完成后的文件夹名称</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  return<span class=\"token punctuation\">(</span>list.dirs<span class=\"token punctuation\">(</span>path <span class=\"token operator\">=</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> full.names <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> recursive <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>sample_dirs <span class=\"token operator\">&lt;-</span> organize_files<span class=\"token punctuation\">(</span>file.path<span class=\"token punctuation\">(</span>datadir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSE151177_RAW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>于是我们就获得了以下文件夹：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre> ls</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    目录<span class=\"token operator\">:</span> D<span class=\"token operator\">:</span>\\Study\\Project\\GDG\\scPsoriasis\\data\\GSE151177\\GSE151177_RAW</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Mode                 LastWriteTime         Length Name</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>                 <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567877_Control01</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567878_Control02</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567879_Control03</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567880_Control04</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567881_Control05</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567882_Control05F</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567883_Psoriasis01</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567884_Psoriasis02</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567885_Psoriasis02F</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567886_Psoriasis03</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567887_Psoriasis03F</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567888_Psoriasis04</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567889_Psoriasis04F</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567890_Psoriasis05</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567891_Psoriasis06</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567892_Psoriasis06F</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567893_Psoriasis07</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567894_Psoriasis08</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567895_Psoriasis09</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567896_Psoriasis10</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567897_Psoriasis11</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567898_Psoriasis12</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>d<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">9</span><span class=\"token operator\">/</span><span class=\"token number\">14</span><span class=\"token operator\">/</span><span class=\"token number\">2024</span>   <span class=\"token number\">7</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> PM                GSM4567899_Psoriasis13</pre></td></tr></table></figure><p>每个文件夹中的文件名都是一样的：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre> ls .\\GSM4567877_Control01\\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    目录<span class=\"token operator\">:</span> D<span class=\"token operator\">:</span>\\Study\\Project\\GDG\\scPsoriasis\\data\\GSE151177\\GSE151177_RAW\\GSM4567877_Control01</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Mode                 LastWriteTime         Length Name</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>                 <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">-</span>a<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">5</span><span class=\"token operator\">/</span><span class=\"token number\">24</span><span class=\"token operator\">/</span><span class=\"token number\">2020</span>  <span class=\"token number\">10</span><span class=\"token operator\">:</span><span class=\"token number\">59</span> AM          <span class=\"token number\">13776</span> barcodes.tsv.gz</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">-</span>a<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">5</span><span class=\"token operator\">/</span><span class=\"token number\">24</span><span class=\"token operator\">/</span><span class=\"token number\">2020</span>  <span class=\"token number\">10</span><span class=\"token operator\">:</span><span class=\"token number\">59</span> AM         <span class=\"token number\">304728</span> features.tsv.gz</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">-</span>a<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>         <span class=\"token number\">5</span><span class=\"token operator\">/</span><span class=\"token number\">24</span><span class=\"token operator\">/</span><span class=\"token number\">2020</span>  <span class=\"token number\">10</span><span class=\"token operator\">:</span><span class=\"token number\">59</span> AM       <span class=\"token number\">16419935</span> matrix.mtx.gz</pre></td></tr></table></figure><p>在 Seurat V4 中，我们可以循环读取多个样本，然后 merge：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>library<span class=\"token punctuation\">(</span>Seurat<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>datadir <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"D:/Study/Project/GDG/scPsoriasis/data/GSE151177/\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>setwd<span class=\"token punctuation\">(</span>file.path<span class=\"token punctuation\">(</span>datadir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSE151177_RAW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>sample_dirs <span class=\"token operator\">&lt;-</span> list.dirs<span class=\"token punctuation\">(</span>path <span class=\"token operator\">=</span> getwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> full.names <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> recursive <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>seurat_object_list <span class=\"token operator\">&lt;-</span> lapply<span class=\"token punctuation\">(</span>sample_dirs<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  print<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  folder <span class=\"token operator\">&lt;-</span> file.path<span class=\"token punctuation\">(</span>datadair<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSE151177_RAW/\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> Read10X<span class=\"token punctuation\">(</span>folder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                     project <span class=\"token operator\">=</span> x<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                     min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                     min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 合并多个样本</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>seurat_object <span class=\"token operator\">&lt;-</span> merge<span class=\"token punctuation\">(</span>seurat_object_list<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                       y <span class=\"token operator\">=</span> seurat_object_list<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                       add.cell.ids <span class=\"token operator\">=</span> samples<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                       project <span class=\"token operator\">=</span> <span class=\"token string\">\"GSE151177\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>但是 Seurat V5 修改了 Seurat 数据对象的结构，merge 操作并不会将样本的表达量矩阵合并</p>\n<p><code>Read10X()</code>  函数可以接受多个路径，因此在 Seurat V5 中，我们可以直接传入这些子文件夹：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>library<span class=\"token punctuation\">(</span>Seurat<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>datadir <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"D:/Study/Project/GDG/scPsoriasis/data/GSE151177/\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>setwd<span class=\"token punctuation\">(</span>file.path<span class=\"token punctuation\">(</span>datadir<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSE151177_RAW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>sample_dirs <span class=\"token operator\">&lt;-</span> list.dirs<span class=\"token punctuation\">(</span>path <span class=\"token operator\">=</span> getwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> full.names <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">,</span> recursive <span class=\"token operator\">=</span> <span class=\"token boolean\">FALSE</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>seurat_object <span class=\"token operator\">&lt;-</span> Read10X<span class=\"token punctuation\">(</span>sample_dirs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>seurat_object <span class=\"token operator\">&lt;-</span> CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> seurat_object<span class=\"token punctuation\">,</span> min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"如何修改单细胞样品名字\"><a class=\"anchor\" href=\"#如何修改单细胞样品名字\">#</a> 如何修改单细胞样品名字</h3>\n<p>我们提取 GSE151177 数据中的 10 个样本（银屑病样本，试剂盒版本 V2.0，共 10 个样本）来进行这部分的教程。</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>psoriasis_v2_dirs <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"GSM4567883_Psoriasis01\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567884_Psoriasis02\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567886_Psoriasis03\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567888_Psoriasis04\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567890_Psoriasis05\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567891_Psoriasis06\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567893_Psoriasis07\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567894_Psoriasis08\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567895_Psoriasis09\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GSM4567896_Psoriasis10\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>seurat_object <span class=\"token operator\">&lt;-</span> Read10X<span class=\"token punctuation\">(</span>psoriasis_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> .<span class=\"token punctuation\">,</span> min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>由此获得了一个 Seurat 对象 seurat_object</p>\n<p>元数据字段  <code>orig.ident</code>  （通常存储在  <code>meta.data</code>  中）通常用于跟踪每个细胞样本来自哪个实验条件、患者、时间点或其他实验分组，这对于下游分析非常有用，尤其是当需要区分或比较不同样本时。可以用 <code>seurat_object$orig.ident</code>  来访问。</p>\n<p>如果你是按照前文进行读取，你会发现  <code>orig.ident</code>  在 Seurat 对象中被存储为从 1 开始的 ** 因子类型（factor）** 而不是我们期望的样本名。在后续的作图分析中，如果样本信息只是数值，还要对应回原本的样本名去查看，这样并不直观。因此我们需要将 Seurat 对象中的  <code>orig.ident</code>  替换为真实的样本名字。</p>\n<h4 id=\"如果你想知道原理\"><a class=\"anchor\" href=\"#如果你想知道原理\">#</a> 如果你想知道原理</h4>\n<p>这里就会出现一些不对应的问题，例如当我们的样本数量超过 9 个的时候：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> levels<span class=\"token punctuation\">(</span>seurat_object<span class=\"token operator\">$</span>orig.ident<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"1\"</span>  <span class=\"token string\">\"10\"</span> <span class=\"token string\">\"2\"</span>  <span class=\"token string\">\"3\"</span>  <span class=\"token string\">\"4\"</span>  <span class=\"token string\">\"5\"</span>  <span class=\"token string\">\"6\"</span>  <span class=\"token string\">\"7\"</span>  <span class=\"token string\">\"8\"</span>  <span class=\"token string\">\"9\"</span></pre></td></tr></table></figure><p>可以发现合并样本的顺序是 <code>&quot;1&quot;  &quot;10&quot; &quot;2&quot;...</code> ，在 R 中，因子的默认排序方式是按照<strong>字典序</strong>（也叫作<strong>字母顺序</strong>）进行排列的，而不是按照数值的大小进行排序。因为 R 默认将因子的水平（levels）视作字符，而在字典序中，&quot;10&quot; 会被认为比 &quot;2&quot; 小，因为比较的是字符串的每个字符的顺序：</p>\n<ul>\n<li>&quot;1&quot; 和 &quot;10&quot; 的首字符都是 &quot;1&quot;，所以相同。</li>\n<li>但在 &quot;10&quot; 中，第二个字符是 &quot;0&quot;，而在 &quot;2&quot; 中是 &quot;2&quot;，按照字母表顺序，&quot;0&quot; 比 &quot;2&quot; 更靠前。</li>\n</ul>\n<p>如何知道这些因子对应的到底是哪些样本呢？可以通过查看细胞数量来判断：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> as.data.frame<span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">(</span>seurat_object<span class=\"token operator\">$</span>orig.ident<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   Var1 Freq</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span>     <span class=\"token number\">1</span>  <span class=\"token number\">660</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span>    <span class=\"token number\">10</span> <span class=\"token number\">1976</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">3</span>     <span class=\"token number\">2</span>  <span class=\"token number\">682</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">4</span>     <span class=\"token number\">3</span> <span class=\"token number\">1232</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">5</span>     <span class=\"token number\">4</span>  <span class=\"token number\">945</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">6</span>     <span class=\"token number\">5</span>  <span class=\"token number\">969</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">7</span>     <span class=\"token number\">6</span> <span class=\"token number\">1432</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">8</span>     <span class=\"token number\">7</span>  <span class=\"token number\">768</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">9</span>     <span class=\"token number\">8</span> <span class=\"token number\">2186</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">10</span>    <span class=\"token number\">9</span> <span class=\"token number\">2891</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token comment\"># 查看每个 psoriasis_v2 样本的细胞数量</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">></span> lapply<span class=\"token punctuation\">(</span>psoriasis_v2_dirs<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">+</span>   print<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">+</span>   print<span class=\"token punctuation\">(</span>dim<span class=\"token punctuation\">(</span>CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> Read10X<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">+</span>                                min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">+</span>                                min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">+</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567883_Psoriasis01\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">14913</span>   <span class=\"token number\">660</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567884_Psoriasis02\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">15027</span>   <span class=\"token number\">682</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567886_Psoriasis03\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">16899</span>  <span class=\"token number\">1232</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567888_Psoriasis04\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">15941</span>   <span class=\"token number\">945</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567890_Psoriasis05\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">15587</span>   <span class=\"token number\">969</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567891_Psoriasis06\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">16629</span>  <span class=\"token number\">1432</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567893_Psoriasis07\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">15836</span>   <span class=\"token number\">768</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567894_Psoriasis08\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">17437</span>  <span class=\"token number\">2186</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567895_Psoriasis09\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">18432</span>  <span class=\"token number\">2891</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"GSM4567896_Psoriasis10\"</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">17813</span>  <span class=\"token number\">1976</span></pre></td></tr></table></figure><p>所以我们可以知道，在读取时， <code>Read10X()</code>  确实是按照我们的  <code>psoriasis_v2_dirs</code>  中的文件夹顺序来读取的，但是他并没有按照  <code>psoriasis_v2_dirs</code>  中的文件夹名去命名我们的样本，而是按顺序给了一个因子，只不过在合并样本的时候，由于因子的默认排序方式是按照字典序进行排列的，因此合并的顺序发生了变化。</p>\n<p>知道对应关系后我们就可以替换样本名了，使用 <a href=\"https://satijalab.org/seurat/articles/essential_commands.html#standard-seurat-workflow\">Seurat 的  <code>RenameIdents()</code>  函数</a>：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>psoriasis_v2_samples <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"Psoriasis01\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis10\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis02\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis03\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis04\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis05\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis06\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis07\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis08\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis09\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>names<span class=\"token punctuation\">(</span>psoriasis_v2_samples<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> levels<span class=\"token punctuation\">(</span>seurat_object<span class=\"token operator\">$</span>orig.ident<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>seurat_object <span class=\"token operator\">&lt;-</span> RenameIdents<span class=\"token punctuation\">(</span>seurat_object<span class=\"token punctuation\">,</span> psoriasis_v2_samples<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"更简单的方法\"><a class=\"anchor\" href=\"#更简单的方法\">#</a> 更简单的方法</h4>\n<p>其实在数据读入的时候就可以直接命名样本</p>\n<p>通过查看 <a href=\"https://github.com/satijalab/seurat/blob/1549dcb3075eaeac01c925c4b4bb73c73450fc50/R/preprocessing.R#L980\"> <code>Read10X()</code>  函数的源代码</a>，我们可以发现其实这个函数有一个查看  <code>data.dir</code>  是否有命名的操作：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is.null<span class=\"token punctuation\">(</span>x <span class=\"token operator\">=</span> names<span class=\"token punctuation\">(</span>x <span class=\"token operator\">=</span> data.dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token ellipsis\">...</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>所以我们可以直接在一开始使用样本名来命名文件夹向量：</p>\n<figure class=\"highlight r\"><figcaption data-lang=\"r\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>psoriasis_v2_samples <span class=\"token operator\">&lt;-</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"Psoriasis01\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis02\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis03\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis04\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis05\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis06\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis07\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis08\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis09\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Psoriasis10\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>names<span class=\"token punctuation\">(</span>psoriasis_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;-</span> psoriasis_v2_samples</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>seurat_object <span class=\"token operator\">&lt;-</span> Read10X<span class=\"token punctuation\">(</span>psoriasis_v2_dirs<span class=\"token punctuation\">)</span> <span class=\"token percent-operator operator\">%>%</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  CreateSeuratObject<span class=\"token punctuation\">(</span>counts <span class=\"token operator\">=</span> .<span class=\"token punctuation\">,</span> min.cells <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> min.features <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">></span> levels<span class=\"token punctuation\">(</span>seurat_object<span class=\"token operator\">$</span>orig.ident<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"Psoriasis01\"</span> <span class=\"token string\">\"Psoriasis02\"</span> <span class=\"token string\">\"Psoriasis03\"</span> <span class=\"token string\">\"Psoriasis04\"</span> <span class=\"token string\">\"Psoriasis05\"</span> <span class=\"token string\">\"Psoriasis06\"</span> <span class=\"token string\">\"Psoriasis07\"</span> <span class=\"token string\">\"Psoriasis08\"</span> <span class=\"token string\">\"Psoriasis09\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token string\">\"Psoriasis10\"</span></pre></td></tr></table></figure>",
            "tags": [
                "R",
                "scRNA-seq",
                "Seurat"
            ]
        }
    ]
}